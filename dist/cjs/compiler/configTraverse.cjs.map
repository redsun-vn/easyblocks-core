{"version":3,"file":"configTraverse.cjs","sources":["../../../src/compiler/configTraverse.ts"],"sourcesContent":["import { NoCodeComponentEntry, SchemaProp } from \"../types\";\r\nimport { findComponentDefinition } from \"./findComponentDefinition\";\r\nimport { isSchemaPropComponent } from \"./schema\";\r\nimport { CompilationContextType } from \"./types\";\r\n\r\ntype ConfigTraverseCallback = (arg: {\r\n  path: string;\r\n  value: any;\r\n  schemaProp: SchemaProp;\r\n  config: NoCodeComponentEntry;\r\n}) => void;\r\n\r\n/**\r\n * Traverses given `config` by invoking given `callback` for each schema prop defined within components from `context`\r\n */\r\nfunction configTraverse(\r\n  config: NoCodeComponentEntry,\r\n  context: Pick<CompilationContextType, \"definitions\">,\r\n  callback: ConfigTraverseCallback\r\n): void {\r\n  configTraverseInternal(config, context, callback, \"\");\r\n}\r\n\r\nfunction configTraverseArray(\r\n  array: NoCodeComponentEntry[],\r\n  context: Pick<CompilationContextType, \"definitions\">,\r\n  callback: ConfigTraverseCallback,\r\n  path: string\r\n) {\r\n  array.forEach((config, index) => {\r\n    configTraverseInternal(config, context, callback, `${path}.${index}`);\r\n  });\r\n}\r\n\r\nfunction configTraverseInternal(\r\n  config: NoCodeComponentEntry,\r\n  context: Pick<CompilationContextType, \"definitions\">,\r\n  callback: ConfigTraverseCallback,\r\n  path: string\r\n) {\r\n  const componentDefinition = findComponentDefinition(config, context);\r\n\r\n  if (!componentDefinition) {\r\n    console.warn(\r\n      `[configTraverse] Unknown component definition for: ${config._component}`\r\n    );\r\n    return;\r\n  }\r\n\r\n  const pathPrefix = path === \"\" ? \"\" : path + \".\";\r\n\r\n  componentDefinition.schema.forEach((schemaProp) => {\r\n    if (\r\n      isSchemaPropComponent(schemaProp) ||\r\n      schemaProp.type === \"component-collection\"\r\n    ) {\r\n      callback({\r\n        config,\r\n        value: config[schemaProp.prop],\r\n        path: `${pathPrefix}${schemaProp.prop}`,\r\n        schemaProp,\r\n      });\r\n\r\n      configTraverseArray(\r\n        config[schemaProp.prop],\r\n        context,\r\n        callback,\r\n        `${pathPrefix}${schemaProp.prop}`\r\n      );\r\n    } else if (schemaProp.type === \"component-collection-localised\") {\r\n      callback({\r\n        config,\r\n        value: config[schemaProp.prop],\r\n        path: `${pathPrefix}${schemaProp.prop}`,\r\n        schemaProp,\r\n      });\r\n\r\n      for (const locale in config[schemaProp.prop]) {\r\n        configTraverseArray(\r\n          config[schemaProp.prop][locale],\r\n          context,\r\n          callback,\r\n          `${pathPrefix}${schemaProp.prop}.${locale}`\r\n        );\r\n      }\r\n    } else {\r\n      const currentPath = `${pathPrefix}${schemaProp.prop}`;\r\n      callback({\r\n        config,\r\n        path: currentPath,\r\n        value: config[schemaProp.prop],\r\n        schemaProp,\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nexport { configTraverse };\r\n"],"names":["configTraverse","config","context","callback","configTraverseInternal","configTraverseArray","array","path","forEach","index","componentDefinition","findComponentDefinition","console","warn","_component","pathPrefix","schema","schemaProp","isSchemaPropComponent","type","value","prop","locale","currentPath"],"mappings":"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"}