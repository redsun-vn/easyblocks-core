{"version":3,"file":"compileInternal.cjs","sources":["../../../src/compiler/compileInternal.ts"],"sourcesContent":["import {\r\n  CompilationMetadata,\r\n  CompiledShopstoryComponentConfig,\r\n  NoCodeComponentEntry,\r\n} from \"../types\";\r\nimport { CompilationCache } from \"./CompilationCache\";\r\nimport { normalize } from \"./normalize\";\r\nimport { compileComponent } from \"./compileComponent\";\r\nimport { CompilationContextType, ContextProps } from \"./types\";\r\nimport { getDevicesWidths } from \"./devices\";\r\n\r\ntype CompileInternalReturnType = {\r\n  compiled: CompiledShopstoryComponentConfig;\r\n  meta: CompilationMetadata;\r\n  configAfterAuto?: NoCodeComponentEntry;\r\n};\r\n\r\nexport function compileInternal(\r\n  configComponent: NoCodeComponentEntry,\r\n  compilationContext: CompilationContextType,\r\n  cache = new CompilationCache()\r\n): CompileInternalReturnType {\r\n  const normalizedConfig = normalize(configComponent, compilationContext);\r\n\r\n  const meta: CompilationMetadata = {\r\n    vars: {\r\n      definitions: {\r\n        links: [],\r\n        actions: [],\r\n        components: [],\r\n        textModifiers: [],\r\n      },\r\n      devices: compilationContext.devices,\r\n      locale: compilationContext.contextParams.locale,\r\n    },\r\n  };\r\n\r\n  const contextProps: ContextProps = {\r\n    $width: getDevicesWidths(compilationContext.devices),\r\n    $widthAuto: {\r\n      $res: true,\r\n      ...Object.fromEntries(\r\n        compilationContext.devices.map((d) => [d.id, false])\r\n      ),\r\n    },\r\n  };\r\n\r\n  const compilationArtifacts = compileComponent(\r\n    normalizedConfig,\r\n    compilationContext,\r\n    contextProps,\r\n    meta,\r\n    cache\r\n  );\r\n\r\n  const ret: CompileInternalReturnType = {\r\n    compiled:\r\n      compilationArtifacts.compiledComponentConfig as CompiledShopstoryComponentConfig,\r\n    meta: {\r\n      vars: meta.vars,\r\n    },\r\n  };\r\n\r\n  if (compilationContext.isEditing) {\r\n    return {\r\n      ...ret,\r\n      configAfterAuto: compilationArtifacts.configAfterAuto,\r\n    };\r\n  }\r\n\r\n  return ret;\r\n}\r\n"],"names":["compileInternal","configComponent","compilationContext","cache","arguments","length","undefined","CompilationCache","normalizedConfig","normalize","meta","vars","definitions","links","actions","components","textModifiers","devices","locale","contextParams","contextProps","$width","getDevicesWidths","$widthAuto","$res","Object","fromEntries","map","d","id","compilationArtifacts","compileComponent","ret","compiled","compiledComponentConfig","isEditing","configAfterAuto"],"mappings":";;;;;;;;;;AAiBO,SAASA,eAAeA,CAC7BC,eAAqC,EACrCC,kBAA0C,EAEf;AAAA,EAAA,IAD3BC,KAAK,GAAAC,SAAA,CAAAC,MAAA,GAAAD,CAAAA,IAAAA,SAAA,CAAAE,CAAAA,CAAAA,KAAAA,SAAA,GAAAF,SAAA,CAAA,CAAA,CAAA,GAAG,IAAIG,iCAAgB,EAAE,CAAA;AAE9B,EAAA,MAAMC,gBAAgB,GAAGC,mBAAS,CAACR,eAAe,EAAEC,kBAAkB,CAAC,CAAA;AAEvE,EAAA,MAAMQ,IAAyB,GAAG;AAChCC,IAAAA,IAAI,EAAE;AACJC,MAAAA,WAAW,EAAE;AACXC,QAAAA,KAAK,EAAE,EAAE;AACTC,QAAAA,OAAO,EAAE,EAAE;AACXC,QAAAA,UAAU,EAAE,EAAE;AACdC,QAAAA,aAAa,EAAE,EAAA;OAChB;MACDC,OAAO,EAAEf,kBAAkB,CAACe,OAAO;AACnCC,MAAAA,MAAM,EAAEhB,kBAAkB,CAACiB,aAAa,CAACD,MAAAA;AAC3C,KAAA;GACD,CAAA;AAED,EAAA,MAAME,YAA0B,GAAG;AACjCC,IAAAA,MAAM,EAAEC,wBAAgB,CAACpB,kBAAkB,CAACe,OAAO,CAAC;AACpDM,IAAAA,UAAU,EAAE;AACVC,MAAAA,IAAI,EAAE,IAAI;AACV,MAAA,GAAGC,MAAM,CAACC,WAAW,CACnBxB,kBAAkB,CAACe,OAAO,CAACU,GAAG,CAAEC,CAAC,IAAK,CAACA,CAAC,CAACC,EAAE,EAAE,KAAK,CAAC,CACrD,CAAA;AACF,KAAA;GACD,CAAA;AAED,EAAA,MAAMC,oBAAoB,GAAGC,iCAAgB,CAC3CvB,gBAAgB,EAChBN,kBAAkB,EAClBkB,YAAY,EACZV,IAAI,EACJP,KACF,CAAC,CAAA;AAED,EAAA,MAAM6B,GAA8B,GAAG;IACrCC,QAAQ,EACNH,oBAAoB,CAACI,uBAA2D;AAClFxB,IAAAA,IAAI,EAAE;MACJC,IAAI,EAAED,IAAI,CAACC,IAAAA;AACb,KAAA;GACD,CAAA;EAED,IAAIT,kBAAkB,CAACiC,SAAS,EAAE;IAChC,OAAO;AACL,MAAA,GAAGH,GAAG;MACNI,eAAe,EAAEN,oBAAoB,CAACM,eAAAA;KACvC,CAAA;AACH,GAAA;AAEA,EAAA,OAAOJ,GAAG,CAAA;AACZ;;;;"}