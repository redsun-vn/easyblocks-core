{"version":3,"file":"traverseComponents.cjs","sources":["../../../src/compiler/traverseComponents.ts"],"sourcesContent":["import { NoCodeComponentEntry } from \"../types\";\nimport { findComponentDefinition } from \"./findComponentDefinition\";\nimport { isSchemaPropComponent } from \"./schema\";\nimport { CompilationContextType } from \"./types\";\n\ntype TraverseComponentsCallback = (arg: {\n  path: string;\n  componentConfig: NoCodeComponentEntry;\n}) => void;\n/**\n * Traverses given `config` by invoking given `callback` for each schema prop defined within components from `context`\n */\nfunction traverseComponents(\n  config: NoCodeComponentEntry,\n  context: CompilationContextType,\n  callback: TraverseComponentsCallback\n): void {\n  traverseComponentsInternal(config, context, callback, \"\");\n}\n\nfunction traverseComponentsArray(\n  array: NoCodeComponentEntry[],\n  context: CompilationContextType,\n  callback: TraverseComponentsCallback,\n  path: string\n) {\n  array.forEach((config, index) => {\n    traverseComponentsInternal(config, context, callback, `${path}.${index}`);\n  });\n}\n\nfunction traverseComponentsInternal(\n  componentConfig: NoCodeComponentEntry,\n  context: CompilationContextType,\n  callback: TraverseComponentsCallback,\n  path: string\n) {\n  const componentDefinition = findComponentDefinition(componentConfig, context);\n\n  if (!componentDefinition) {\n    console.warn(\n      \"[traverseComponents] Unknown component definition\",\n      componentConfig\n    );\n    return;\n  }\n\n  const pathPrefix = path === \"\" ? \"\" : path + \".\";\n\n  callback({ componentConfig, path });\n\n  componentDefinition.schema.forEach((schemaProp) => {\n    if (\n      isSchemaPropComponent(schemaProp) ||\n      schemaProp.type === \"component-collection\"\n    ) {\n      traverseComponentsArray(\n        componentConfig[schemaProp.prop],\n        context,\n        callback,\n        `${pathPrefix}${schemaProp.prop}`\n      );\n    } else if (schemaProp.type === \"component-collection-localised\") {\n      for (const locale in componentConfig[schemaProp.prop]) {\n        traverseComponentsArray(\n          componentConfig[schemaProp.prop][locale],\n          context,\n          callback,\n          `${pathPrefix}${schemaProp.prop}.${locale}`\n        );\n      }\n    }\n  });\n}\n\nexport { traverseComponents };\n"],"names":["traverseComponents","config","context","callback","traverseComponentsInternal","traverseComponentsArray","array","path","forEach","index","componentConfig","componentDefinition","findComponentDefinition","console","warn","pathPrefix","schema","schemaProp","isSchemaPropComponent","type","prop","locale"],"mappings":";;;;;;;;AASA;AACA;AACA;AACA,SAASA,kBAAkBA,CACzBC,MAA4B,EAC5BC,OAA+B,EAC/BC,QAAoC,EAC9B;EACNC,0BAA0B,CAACH,MAAM,EAAEC,OAAO,EAAEC,QAAQ,EAAE,EAAE,CAAC,CAAA;AAC3D,CAAA;AAEA,SAASE,uBAAuBA,CAC9BC,KAA6B,EAC7BJ,OAA+B,EAC/BC,QAAoC,EACpCI,IAAY,EACZ;AACAD,EAAAA,KAAK,CAACE,OAAO,CAAC,CAACP,MAAM,EAAEQ,KAAK,KAAK;AAC/BL,IAAAA,0BAA0B,CAACH,MAAM,EAAEC,OAAO,EAAEC,QAAQ,EAAE,CAAA,EAAGI,IAAI,CAAA,CAAA,EAAIE,KAAK,CAAA,CAAE,CAAC,CAAA;AAC3E,GAAC,CAAC,CAAA;AACJ,CAAA;AAEA,SAASL,0BAA0BA,CACjCM,eAAqC,EACrCR,OAA+B,EAC/BC,QAAoC,EACpCI,IAAY,EACZ;AACA,EAAA,MAAMI,mBAAmB,GAAGC,+CAAuB,CAACF,eAAe,EAAER,OAAO,CAAC,CAAA;EAE7E,IAAI,CAACS,mBAAmB,EAAE;AACxBE,IAAAA,OAAO,CAACC,IAAI,CACV,mDAAmD,EACnDJ,eACF,CAAC,CAAA;AACD,IAAA,OAAA;AACF,GAAA;EAEA,MAAMK,UAAU,GAAGR,IAAI,KAAK,EAAE,GAAG,EAAE,GAAGA,IAAI,GAAG,GAAG,CAAA;AAEhDJ,EAAAA,QAAQ,CAAC;IAAEO,eAAe;AAAEH,IAAAA,IAAAA;AAAK,GAAC,CAAC,CAAA;AAEnCI,EAAAA,mBAAmB,CAACK,MAAM,CAACR,OAAO,CAAES,UAAU,IAAK;IACjD,IACEC,2BAAqB,CAACD,UAAU,CAAC,IACjCA,UAAU,CAACE,IAAI,KAAK,sBAAsB,EAC1C;AACAd,MAAAA,uBAAuB,CACrBK,eAAe,CAACO,UAAU,CAACG,IAAI,CAAC,EAChClB,OAAO,EACPC,QAAQ,EACR,GAAGY,UAAU,CAAA,EAAGE,UAAU,CAACG,IAAI,EACjC,CAAC,CAAA;AACH,KAAC,MAAM,IAAIH,UAAU,CAACE,IAAI,KAAK,gCAAgC,EAAE;MAC/D,KAAK,MAAME,MAAM,IAAIX,eAAe,CAACO,UAAU,CAACG,IAAI,CAAC,EAAE;QACrDf,uBAAuB,CACrBK,eAAe,CAACO,UAAU,CAACG,IAAI,CAAC,CAACC,MAAM,CAAC,EACxCnB,OAAO,EACPC,QAAQ,EACR,CAAGY,EAAAA,UAAU,CAAGE,EAAAA,UAAU,CAACG,IAAI,CAAA,CAAA,EAAIC,MAAM,CAAA,CAC3C,CAAC,CAAA;AACH,OAAA;AACF,KAAA;AACF,GAAC,CAAC,CAAA;AACJ;;;;"}