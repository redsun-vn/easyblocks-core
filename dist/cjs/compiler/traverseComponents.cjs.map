{"version":3,"file":"traverseComponents.cjs","sources":["../../../src/compiler/traverseComponents.ts"],"sourcesContent":["import { NoCodeComponentEntry } from \"../types\";\r\nimport { findComponentDefinition } from \"./findComponentDefinition\";\r\nimport { isSchemaPropComponent } from \"./schema\";\r\nimport { CompilationContextType } from \"./types\";\r\n\r\ntype TraverseComponentsCallback = (arg: {\r\n  path: string;\r\n  componentConfig: NoCodeComponentEntry;\r\n}) => void;\r\n/**\r\n * Traverses given `config` by invoking given `callback` for each schema prop defined within components from `context`\r\n */\r\nfunction traverseComponents(\r\n  config: NoCodeComponentEntry,\r\n  context: CompilationContextType,\r\n  callback: TraverseComponentsCallback\r\n): void {\r\n  traverseComponentsInternal(config, context, callback, \"\");\r\n}\r\n\r\nfunction traverseComponentsArray(\r\n  array: NoCodeComponentEntry[],\r\n  context: CompilationContextType,\r\n  callback: TraverseComponentsCallback,\r\n  path: string\r\n) {\r\n  array.forEach((config, index) => {\r\n    traverseComponentsInternal(config, context, callback, `${path}.${index}`);\r\n  });\r\n}\r\n\r\nfunction traverseComponentsInternal(\r\n  componentConfig: NoCodeComponentEntry,\r\n  context: CompilationContextType,\r\n  callback: TraverseComponentsCallback,\r\n  path: string\r\n) {\r\n  const componentDefinition = findComponentDefinition(componentConfig, context);\r\n\r\n  if (!componentDefinition) {\r\n    console.warn(\r\n      \"[traverseComponents] Unknown component definition\",\r\n      componentConfig\r\n    );\r\n    return;\r\n  }\r\n\r\n  const pathPrefix = path === \"\" ? \"\" : path + \".\";\r\n\r\n  callback({ componentConfig, path });\r\n\r\n  componentDefinition.schema.forEach((schemaProp) => {\r\n    if (\r\n      isSchemaPropComponent(schemaProp) ||\r\n      schemaProp.type === \"component-collection\"\r\n    ) {\r\n      traverseComponentsArray(\r\n        componentConfig[schemaProp.prop],\r\n        context,\r\n        callback,\r\n        `${pathPrefix}${schemaProp.prop}`\r\n      );\r\n    } else if (schemaProp.type === \"component-collection-localised\") {\r\n      for (const locale in componentConfig[schemaProp.prop]) {\r\n        traverseComponentsArray(\r\n          componentConfig[schemaProp.prop][locale],\r\n          context,\r\n          callback,\r\n          `${pathPrefix}${schemaProp.prop}.${locale}`\r\n        );\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nexport { traverseComponents };\r\n"],"names":["traverseComponents","config","context","callback","traverseComponentsInternal","traverseComponentsArray","array","path","forEach","index","componentConfig","componentDefinition","findComponentDefinition","console","warn","pathPrefix","schema","schemaProp","isSchemaPropComponent","type","prop","locale"],"mappings":";;;;;;;;AASA;AACA;AACA;AACA,SAASA,kBAAkBA,CACzBC,MAA4B,EAC5BC,OAA+B,EAC/BC,QAAoC,EAC9B;EACNC,0BAA0B,CAACH,MAAM,EAAEC,OAAO,EAAEC,QAAQ,EAAE,EAAE,CAAC,CAAA;AAC3D,CAAA;AAEA,SAASE,uBAAuBA,CAC9BC,KAA6B,EAC7BJ,OAA+B,EAC/BC,QAAoC,EACpCI,IAAY,EACZ;AACAD,EAAAA,KAAK,CAACE,OAAO,CAAC,CAACP,MAAM,EAAEQ,KAAK,KAAK;AAC/BL,IAAAA,0BAA0B,CAACH,MAAM,EAAEC,OAAO,EAAEC,QAAQ,EAAE,CAAA,EAAGI,IAAI,CAAA,CAAA,EAAIE,KAAK,CAAA,CAAE,CAAC,CAAA;AAC3E,GAAC,CAAC,CAAA;AACJ,CAAA;AAEA,SAASL,0BAA0BA,CACjCM,eAAqC,EACrCR,OAA+B,EAC/BC,QAAoC,EACpCI,IAAY,EACZ;AACA,EAAA,MAAMI,mBAAmB,GAAGC,+CAAuB,CAACF,eAAe,EAAER,OAAO,CAAC,CAAA;EAE7E,IAAI,CAACS,mBAAmB,EAAE;AACxBE,IAAAA,OAAO,CAACC,IAAI,CACV,mDAAmD,EACnDJ,eACF,CAAC,CAAA;AACD,IAAA,OAAA;AACF,GAAA;EAEA,MAAMK,UAAU,GAAGR,IAAI,KAAK,EAAE,GAAG,EAAE,GAAGA,IAAI,GAAG,GAAG,CAAA;AAEhDJ,EAAAA,QAAQ,CAAC;IAAEO,eAAe;AAAEH,IAAAA,IAAAA;AAAK,GAAC,CAAC,CAAA;AAEnCI,EAAAA,mBAAmB,CAACK,MAAM,CAACR,OAAO,CAAES,UAAU,IAAK;IACjD,IACEC,2BAAqB,CAACD,UAAU,CAAC,IACjCA,UAAU,CAACE,IAAI,KAAK,sBAAsB,EAC1C;AACAd,MAAAA,uBAAuB,CACrBK,eAAe,CAACO,UAAU,CAACG,IAAI,CAAC,EAChClB,OAAO,EACPC,QAAQ,EACR,GAAGY,UAAU,CAAA,EAAGE,UAAU,CAACG,IAAI,EACjC,CAAC,CAAA;AACH,KAAC,MAAM,IAAIH,UAAU,CAACE,IAAI,KAAK,gCAAgC,EAAE;MAC/D,KAAK,MAAME,MAAM,IAAIX,eAAe,CAACO,UAAU,CAACG,IAAI,CAAC,EAAE;QACrDf,uBAAuB,CACrBK,eAAe,CAACO,UAAU,CAACG,IAAI,CAAC,CAACC,MAAM,CAAC,EACxCnB,OAAO,EACPC,QAAQ,EACR,CAAGY,EAAAA,UAAU,CAAGE,EAAAA,UAAU,CAACG,IAAI,CAAA,CAAA,EAAIC,MAAM,CAAA,CAC3C,CAAC,CAAA;AACH,OAAA;AACF,KAAA;AACF,GAAC,CAAC,CAAA;AACJ;;;;"}