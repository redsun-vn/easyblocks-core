{"version":3,"file":"mergeCompilationMeta.cjs","sources":["../../../src/compiler/mergeCompilationMeta.ts"],"sourcesContent":["import { CompilationMetadata, SerializedComponentDefinitions } from \"../types\";\r\n\r\nexport function mergeCompilationMeta(\r\n  meta1: CompilationMetadata | undefined,\r\n  meta2: CompilationMetadata | undefined\r\n): CompilationMetadata {\r\n  if (!meta2 && !meta1) {\r\n    throw new Error(\"Can't merge empty metadata\");\r\n  }\r\n\r\n  if (!meta2) {\r\n    return meta1!;\r\n  }\r\n\r\n  if (!meta1) {\r\n    return meta2;\r\n  }\r\n\r\n  return {\r\n    vars: {\r\n      ...meta1.vars,\r\n      ...meta2.vars,\r\n      definitions: {\r\n        actions: mergeDefinitions(\r\n          meta1.vars.definitions?.actions ?? [],\r\n          meta2.vars.definitions?.actions ?? []\r\n        ),\r\n        components: mergeDefinitions(\r\n          meta1.vars.definitions?.components ?? [],\r\n          meta2.vars.definitions?.components ?? []\r\n        ),\r\n        textModifiers: mergeDefinitions(\r\n          meta1.vars.definitions?.textModifiers ?? [],\r\n          meta2.vars.definitions?.textModifiers ?? []\r\n        ),\r\n        links: mergeDefinitions(\r\n          meta1.vars.definitions?.links ?? [],\r\n          meta2.vars.definitions?.links ?? []\r\n        ),\r\n      },\r\n    },\r\n  };\r\n}\r\n\r\nfunction mergeDefinitions<\r\n  Definitions extends SerializedComponentDefinitions[keyof SerializedComponentDefinitions]\r\n>(definitions1: Definitions, definitions2: Definitions) {\r\n  const mergeDefinitions = [...definitions1];\r\n\r\n  definitions2.forEach((definition) => {\r\n    const isDuplicate = definitions1.some((d) => d.id === definition.id);\r\n\r\n    if (isDuplicate) {\r\n      return;\r\n    }\r\n\r\n    mergeDefinitions.push(definition);\r\n  });\r\n\r\n  return mergeDefinitions;\r\n}\r\n"],"names":["mergeCompilationMeta","meta1","meta2","Error","vars","definitions","actions","mergeDefinitions","components","textModifiers","links","definitions1","definitions2","forEach","definition","isDuplicate","some","d","id","push"],"mappings":";;;;;AAEO,SAASA,oBAAoBA,CAClCC,KAAsC,EACtCC,KAAsC,EACjB;AACrB,EAAA,IAAI,CAACA,KAAK,IAAI,CAACD,KAAK,EAAE;AACpB,IAAA,MAAM,IAAIE,KAAK,CAAC,4BAA4B,CAAC,CAAA;AAC/C,GAAA;EAEA,IAAI,CAACD,KAAK,EAAE;AACV,IAAA,OAAOD,KAAK,CAAA;AACd,GAAA;EAEA,IAAI,CAACA,KAAK,EAAE;AACV,IAAA,OAAOC,KAAK,CAAA;AACd,GAAA;EAEA,OAAO;AACLE,IAAAA,IAAI,EAAE;MACJ,GAAGH,KAAK,CAACG,IAAI;MACb,GAAGF,KAAK,CAACE,IAAI;AACbC,MAAAA,WAAW,EAAE;QACXC,OAAO,EAAEC,gBAAgB,CACvBN,KAAK,CAACG,IAAI,CAACC,WAAW,EAAEC,OAAO,IAAI,EAAE,EACrCJ,KAAK,CAACE,IAAI,CAACC,WAAW,EAAEC,OAAO,IAAI,EACrC,CAAC;QACDE,UAAU,EAAED,gBAAgB,CAC1BN,KAAK,CAACG,IAAI,CAACC,WAAW,EAAEG,UAAU,IAAI,EAAE,EACxCN,KAAK,CAACE,IAAI,CAACC,WAAW,EAAEG,UAAU,IAAI,EACxC,CAAC;QACDC,aAAa,EAAEF,gBAAgB,CAC7BN,KAAK,CAACG,IAAI,CAACC,WAAW,EAAEI,aAAa,IAAI,EAAE,EAC3CP,KAAK,CAACE,IAAI,CAACC,WAAW,EAAEI,aAAa,IAAI,EAC3C,CAAC;QACDC,KAAK,EAAEH,gBAAgB,CACrBN,KAAK,CAACG,IAAI,CAACC,WAAW,EAAEK,KAAK,IAAI,EAAE,EACnCR,KAAK,CAACE,IAAI,CAACC,WAAW,EAAEK,KAAK,IAAI,EACnC,CAAA;AACF,OAAA;AACF,KAAA;GACD,CAAA;AACH,CAAA;AAEA,SAASH,gBAAgBA,CAEvBI,YAAyB,EAAEC,YAAyB,EAAE;AACtD,EAAA,MAAML,gBAAgB,GAAG,CAAC,GAAGI,YAAY,CAAC,CAAA;AAE1CC,EAAAA,YAAY,CAACC,OAAO,CAAEC,UAAU,IAAK;AACnC,IAAA,MAAMC,WAAW,GAAGJ,YAAY,CAACK,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,EAAE,KAAKJ,UAAU,CAACI,EAAE,CAAC,CAAA;AAEpE,IAAA,IAAIH,WAAW,EAAE;AACf,MAAA,OAAA;AACF,KAAA;AAEAR,IAAAA,gBAAgB,CAACY,IAAI,CAACL,UAAU,CAAC,CAAA;AACnC,GAAC,CAAC,CAAA;AAEF,EAAA,OAAOP,gBAAgB,CAAA;AACzB;;;;"}