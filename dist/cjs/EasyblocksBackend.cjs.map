{"version":3,"file":"EasyblocksBackend.cjs","sources":["../../src/EasyblocksBackend.ts"],"sourcesContent":["import {\r\n  Backend,\r\n  NoCodeComponentEntry,\r\n  UserDefinedTemplate,\r\n  Document,\r\n} from \"./types\";\r\n\r\ntype RequestSearchParams = Record<string, string | Array<string>>;\r\n\r\ntype ApiRequestOptions = {\r\n  method: \"GET\" | \"POST\" | \"PUT\" | \"DELETE\" | \"PATCH\";\r\n  body?: any;\r\n  headers?: Record<string, string>;\r\n  searchParams?: RequestSearchParams;\r\n};\r\n\r\ntype ApiGetRequestOptions = Omit<ApiRequestOptions, \"method\" | \"body\">;\r\n\r\ntype ApiPostRequestOptions = Omit<ApiRequestOptions, \"method\">;\r\n\r\ntype ApiPutRequestOptions = Omit<ApiRequestOptions, \"method\">;\r\n\r\ntype ApiDeleteRequestOptions = Omit<ApiRequestOptions, \"method\" | \"body\">;\r\n\r\ntype DateString = string;\r\n\r\nexport type DocumentDTO = {\r\n  archived: boolean;\r\n  config_id: string;\r\n  created_at: DateString;\r\n  id: string;\r\n  project_id: string;\r\n  source: string;\r\n  title: string;\r\n  unique_source_identifier: string | null;\r\n  updated_at: DateString;\r\n  version: number;\r\n  root_container: string | null;\r\n};\r\n\r\nexport type DocumentWithResolvedConfigDTO = DocumentDTO & {\r\n  config: ConfigDTO;\r\n};\r\n\r\nexport type ConfigDTO = {\r\n  config: NoCodeComponentEntry;\r\n  created_at: DateString;\r\n  id: string;\r\n  metadata: Record<string, unknown> | null;\r\n  parent_id: string | null;\r\n  project_id: string;\r\n  updated_at: DateString;\r\n};\r\n\r\ntype Project = {\r\n  id: string;\r\n  name: string;\r\n  tokens: Array<string>;\r\n};\r\n\r\nexport type AssetDTO = {\r\n  id: string;\r\n  name: string;\r\n  url: string;\r\n} & (\r\n  | {\r\n      mediaType: \"image\";\r\n      metadata: { width: number; height: number; mimeType: string };\r\n    }\r\n  | {\r\n      mediaType: \"video\";\r\n      metadata: { mimeType: string };\r\n    }\r\n);\r\n\r\nconst AUTH_HEADER = \"x-shopstory-access-token\";\r\n\r\nexport class EasyblocksBackend implements Backend {\r\n  private project?: {\r\n    id: string;\r\n    tokens: string[];\r\n    name: string;\r\n  };\r\n\r\n  private accessToken: string;\r\n  private rootUrl: string;\r\n\r\n  constructor(args: { accessToken: string; rootUrl?: string }) {\r\n    this.accessToken = args.accessToken;\r\n    this.rootUrl = args.rootUrl ?? \"https://app.easyblocks.io\";\r\n  }\r\n\r\n  private async init() {\r\n    // don't reinitialize\r\n    if (this.project) {\r\n      return;\r\n    }\r\n\r\n    // Set project!\r\n    const response = await this.get(\"/projects\");\r\n\r\n    if (response.ok) {\r\n      const projects = (await response.json()) as Array<Project>;\r\n\r\n      if (projects.length === 0) {\r\n        throw new Error(\r\n          \"Authorization error. Have you provided a correct access token?\"\r\n        );\r\n      }\r\n\r\n      this.project = projects[0];\r\n    } else {\r\n      throw new Error(\"Initialization error in ApiClient\");\r\n    }\r\n  }\r\n\r\n  private async request(path: string, options: ApiRequestOptions) {\r\n    const apiRequestUrl = new URL(`${this.rootUrl}/api${path}`);\r\n\r\n    if (options.searchParams && Object.keys(options.searchParams).length > 0) {\r\n      for (const [key, value] of Object.entries(options.searchParams)) {\r\n        if (Array.isArray(value)) {\r\n          value.forEach((value) => {\r\n            apiRequestUrl.searchParams.append(key, value);\r\n          });\r\n        } else {\r\n          apiRequestUrl.searchParams.set(key, value);\r\n        }\r\n      }\r\n    }\r\n\r\n    const headers: HeadersInit = {\r\n      ...(path.includes(\"assets\")\r\n        ? {}\r\n        : { \"Content-Type\": \"application/json\" }),\r\n      ...options.headers,\r\n      [AUTH_HEADER]: this.accessToken,\r\n    };\r\n\r\n    const body = options.body\r\n      ? typeof options.body === \"object\" && !(options.body instanceof FormData)\r\n        ? JSON.stringify(options.body)\r\n        : options.body\r\n      : undefined;\r\n\r\n    return fetch(apiRequestUrl.toString(), {\r\n      method: options.method,\r\n      headers,\r\n      body,\r\n    });\r\n  }\r\n\r\n  private async get(path: string, options: ApiGetRequestOptions = {}) {\r\n    return this.request(path, { ...options, method: \"GET\" });\r\n  }\r\n\r\n  private async post(path: string, options: ApiPostRequestOptions = {}) {\r\n    return this.request(path, { ...options, method: \"POST\" });\r\n  }\r\n\r\n  private async put(path: string, options: ApiPutRequestOptions = {}) {\r\n    return this.request(path, { ...options, method: \"PUT\" });\r\n  }\r\n\r\n  private async delete(path: string, options: ApiDeleteRequestOptions = {}) {\r\n    return this.request(path, { ...options, method: \"DELETE\" });\r\n  }\r\n\r\n  documents = {\r\n    get: async (payload: { id: string }): Promise<Document> => {\r\n      await this.init();\r\n\r\n      const response = await this.get(\r\n        `/projects/${this.project!.id}/documents/${payload.id}`,\r\n        {\r\n          searchParams: {\r\n            format: \"full\",\r\n          },\r\n        }\r\n      );\r\n\r\n      if (response.ok) {\r\n        return documentWithResolvedConfigDTOToDocument(\r\n          (await response.json()) as DocumentWithResolvedConfigDTO\r\n        );\r\n      }\r\n\r\n      throw new Error(\"Failed to get document\");\r\n    },\r\n\r\n    create: async (\r\n      payload: Omit<Document, \"id\" | \"version\">\r\n    ): Promise<Document> => {\r\n      await this.init();\r\n\r\n      const response = await this.post(\r\n        `/projects/${this.project!.id}/documents`,\r\n        {\r\n          body: {\r\n            title: \"Untitled\",\r\n            config: payload.entry,\r\n            rootContainer: payload.entry._component,\r\n          },\r\n        }\r\n      );\r\n\r\n      if (response.ok) {\r\n        return documentDTOToDocument(\r\n          (await response.json()) as DocumentDTO,\r\n          payload.entry\r\n        );\r\n      }\r\n\r\n      if (response.status === 400) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error);\r\n      }\r\n\r\n      throw new Error(\"Failed to save document\");\r\n    },\r\n\r\n    update: async (payload: Document): Promise<Document> => {\r\n      await this.init();\r\n\r\n      const response = await this.put(\r\n        `/projects/${this.project!.id}/documents/${payload.id}`,\r\n        {\r\n          body: {\r\n            version: payload.version,\r\n            config: payload.entry,\r\n          },\r\n        }\r\n      );\r\n\r\n      if (response.ok) {\r\n        return documentDTOToDocument(\r\n          (await response.json()) as DocumentDTO,\r\n          payload.entry\r\n        );\r\n      }\r\n\r\n      if (response.status === 400) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error);\r\n      }\r\n\r\n      throw new Error(\"Failed to update document\");\r\n    },\r\n  };\r\n\r\n  templates = {\r\n    get: async (payload: { id: string }): Promise<UserDefinedTemplate> => {\r\n      await this.init();\r\n\r\n      // dummy inefficient implementation\r\n      const allTemplates = await this.templates.getAll();\r\n      const template = allTemplates.find(\r\n        (template) => template.id === payload.id\r\n      );\r\n\r\n      if (!template) {\r\n        throw new Error(\"Template not found\");\r\n      }\r\n\r\n      return template;\r\n    },\r\n    getAll: async (): Promise<UserDefinedTemplate[]> => {\r\n      await this.init();\r\n\r\n      try {\r\n        const response = await this.get(\r\n          `/projects/${this.project!.id}/templates`\r\n        );\r\n        const data: Array<any> = await response.json();\r\n\r\n        const templates = data.map<UserDefinedTemplate>((item) => ({\r\n          id: item.id,\r\n          label: item.label,\r\n          entry: item.config.config,\r\n          isUserDefined: true,\r\n          width: item.width,\r\n          widthAuto: item.widthAuto,\r\n        }));\r\n\r\n        return templates;\r\n      } catch (error) {\r\n        console.error(error);\r\n        return [];\r\n      }\r\n    },\r\n    create: async (input: {\r\n      label: string;\r\n      entry: NoCodeComponentEntry;\r\n      width?: number;\r\n      widthAuto?: boolean;\r\n    }): Promise<UserDefinedTemplate> => {\r\n      await this.init();\r\n\r\n      const payload = {\r\n        label: input.label,\r\n        config: input.entry,\r\n        masterTemplateIds: [],\r\n        width: input.width,\r\n        widthAuto: input.widthAuto,\r\n      };\r\n\r\n      const response = await this.request(\r\n        `/projects/${this.project!.id}/templates`,\r\n        {\r\n          method: \"POST\",\r\n          body: JSON.stringify(payload),\r\n        }\r\n      );\r\n\r\n      if (response.status !== 200) {\r\n        throw new Error(\"couldn't create template\");\r\n      }\r\n\r\n      const json = await response.json();\r\n\r\n      return {\r\n        id: json.id,\r\n        label: json.label,\r\n        entry: input.entry,\r\n        isUserDefined: true,\r\n      };\r\n    },\r\n    update: async (input: {\r\n      id: string;\r\n      label: string;\r\n    }): Promise<Omit<UserDefinedTemplate, \"entry\">> => {\r\n      await this.init();\r\n\r\n      const payload = {\r\n        label: input.label,\r\n        masterTemplateIds: [],\r\n      };\r\n\r\n      const response = await this.request(\r\n        `/projects/${this.project!.id}/templates/${input.id}`,\r\n        {\r\n          method: \"PUT\",\r\n          body: JSON.stringify(payload),\r\n        }\r\n      );\r\n\r\n      const json = await response.json();\r\n\r\n      console.log(\"update template json\", json);\r\n\r\n      if (response.status !== 200) {\r\n        throw new Error();\r\n      }\r\n\r\n      return {\r\n        id: json.id,\r\n        label: json.label,\r\n        isUserDefined: true,\r\n      };\r\n    },\r\n    delete: async (input: { id: string }) => {\r\n      await this.init();\r\n\r\n      const response = await this.request(\r\n        `/projects/${this.project!.id}/templates/${input.id}`,\r\n        {\r\n          method: \"DELETE\",\r\n        }\r\n      );\r\n\r\n      if (response.status !== 200) {\r\n        throw new Error();\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nfunction documentDTOToDocument(\r\n  documentDTO: DocumentDTO,\r\n  entry: NoCodeComponentEntry\r\n): Document {\r\n  if (!documentDTO.root_container) {\r\n    throw new Error(\"unexpected server error\");\r\n  }\r\n\r\n  return {\r\n    id: documentDTO.id,\r\n    version: documentDTO.version,\r\n\r\n    entry,\r\n  };\r\n}\r\n\r\nfunction documentWithResolvedConfigDTOToDocument(\r\n  documentWithResolvedConfigDTO: DocumentWithResolvedConfigDTO\r\n): Document {\r\n  return documentDTOToDocument(\r\n    documentWithResolvedConfigDTO,\r\n    documentWithResolvedConfigDTO.config.config\r\n  );\r\n}\r\n"],"names":["AUTH_HEADER","EasyblocksBackend","constructor","args","accessToken","rootUrl","init","project","response","get","ok","projects","json","length","Error","request","path","options","apiRequestUrl","URL","searchParams","Object","keys","key","value","entries","Array","isArray","forEach","append","set","headers","includes","body","FormData","JSON","stringify","undefined","fetch","toString","method","arguments","post","put","delete","documents","payload","id","format","documentWithResolvedConfigDTOToDocument","create","title","config","entry","rootContainer","_component","documentDTOToDocument","status","errorData","error","update","version","templates","allTemplates","getAll","template","find","data","map","item","label","isUserDefined","width","widthAuto","console","input","masterTemplateIds","log","documentDTO","root_container","documentWithResolvedConfigDTO"],"mappings":"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"}