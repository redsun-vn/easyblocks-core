{"version":3,"file":"ComponentBuilder.cjs","sources":["../../../../src/components/ComponentBuilder/ComponentBuilder.tsx"],"sourcesContent":["import React, { ComponentType, Fragment, ReactElement } from \"react\";\r\nimport { findComponentDefinitionById } from \"../../compiler/findComponentDefinition\";\r\nimport {\r\n  isSchemaPropComponent,\r\n  isSchemaPropComponentOrComponentCollection,\r\n} from \"../../compiler/schema\";\r\nimport {\r\n  ContextProps,\r\n  InternalComponentDefinition,\r\n} from \"../../compiler/types\";\r\nimport {\r\n  ComponentPickerClosedEvent,\r\n  componentPickerOpened,\r\n  itemInserted,\r\n} from \"../../events\";\r\nimport {\r\n  getResolvedExternalDataValue,\r\n  isLocalTextReference,\r\n  resolveExternalValue,\r\n} from \"../../resourcesUtils\";\r\nimport {\r\n  isTrulyResponsiveValue,\r\n  responsiveValueGetDefinedValue,\r\n  responsiveValueReduce,\r\n  responsiveValueValues,\r\n} from \"../../responsiveness\";\r\nimport { resop } from \"../../responsiveness/resop\";\r\nimport {\r\n  CompilationMetadata,\r\n  CompiledComponentConfig,\r\n  CompiledLocalTextReference,\r\n  CompiledShopstoryComponentConfig,\r\n  ComponentCollectionLocalisedSchemaProp,\r\n  ComponentCollectionSchemaProp,\r\n  ComponentSchemaProp,\r\n  Devices,\r\n  ExternalData,\r\n  ExternalReference,\r\n  ExternalSchemaProp,\r\n  LocalReference,\r\n  LocalTextReference,\r\n  NoCodeComponentProps,\r\n  ResponsiveValue,\r\n} from \"../../types\";\r\nimport { Box } from \"../Box/Box\";\r\nimport { useEasyblocksExternalData } from \"../EasyblocksExternalDataProvider\";\r\nimport { useEasyblocksMetadata } from \"../EasyblocksMetadataProvider\";\r\n\r\nfunction buildBoxes(\r\n  compiled: any,\r\n  name: string,\r\n  actionWrappers: { [key: string]: any },\r\n  meta: any\r\n): any {\r\n  if (Array.isArray(compiled)) {\r\n    return compiled.map((x: any, index: number) =>\r\n      buildBoxes(x, `${name}.${index}`, actionWrappers, meta)\r\n    );\r\n  } else if (typeof compiled === \"object\" && compiled !== null) {\r\n    if (compiled.__isBox) {\r\n      const boxProps = {\r\n        __compiled: compiled,\r\n        __name: name,\r\n        devices: meta.vars.devices,\r\n        stitches: meta.stitches,\r\n      };\r\n\r\n      return <Box {...boxProps} />;\r\n    }\r\n\r\n    const ret: Record<string, any> = {};\r\n\r\n    for (const key in compiled) {\r\n      ret[key] = buildBoxes(compiled[key], key, actionWrappers, meta);\r\n    }\r\n    return ret;\r\n  }\r\n  return compiled;\r\n}\r\n\r\nfunction getComponentDefinition(\r\n  compiled: CompiledComponentConfig,\r\n  runtimeContext: any\r\n) {\r\n  return findComponentDefinitionById(compiled._component, runtimeContext);\r\n}\r\n\r\n/**\r\n * Checks whether:\r\n * 1. component is renderable (if all non-optional externals are defined)\r\n * 2. is data loading...\r\n * 3. gets fields that are not defined\r\n *\r\n * @param compiled\r\n * @param runtimeContext\r\n * @param rendererContext\r\n */\r\n\r\ntype RenderabilityStatus = {\r\n  renderable: boolean;\r\n  isLoading: boolean;\r\n  fieldsRequiredToRender: Set<string>;\r\n};\r\n\r\nfunction getRenderabilityStatus(\r\n  compiled: CompiledComponentConfig,\r\n  meta: CompilationMetadata,\r\n  externalData: ExternalData\r\n): RenderabilityStatus {\r\n  const status: RenderabilityStatus = {\r\n    renderable: true,\r\n    isLoading: false,\r\n    fieldsRequiredToRender: new Set<string>(),\r\n  };\r\n\r\n  const componentDefinition = getComponentDefinition(compiled, {\r\n    definitions: meta.vars.definitions,\r\n  });\r\n\r\n  if (!componentDefinition) {\r\n    return {\r\n      renderable: false,\r\n      isLoading: false,\r\n      fieldsRequiredToRender: new Set<string>(),\r\n    };\r\n  }\r\n\r\n  const requiredExternalFields = componentDefinition.schema.filter(\r\n    (schemaProp): schemaProp is ExternalSchemaProp => {\r\n      if (schemaProp.type === \"text\") {\r\n        return false;\r\n      }\r\n\r\n      const propValue = compiled.props[schemaProp.prop];\r\n\r\n      if (\r\n        typeof propValue === \"object\" &&\r\n        propValue !== null &&\r\n        \"id\" in propValue &&\r\n        \"widgetId\" in propValue\r\n      ) {\r\n        if (\"optional\" in schemaProp) {\r\n          return !schemaProp.optional;\r\n        }\r\n\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    }\r\n  );\r\n\r\n  if (requiredExternalFields.length === 0) {\r\n    return status;\r\n  }\r\n\r\n  for (const resourceSchemaProp of requiredExternalFields) {\r\n    const externalReference: ResponsiveValue<ExternalReference> =\r\n      compiled.props[resourceSchemaProp.prop];\r\n\r\n    const fieldStatus = getFieldStatus(\r\n      externalReference,\r\n      externalData,\r\n      compiled._id,\r\n      resourceSchemaProp.prop,\r\n      meta.vars.devices\r\n    );\r\n\r\n    status.isLoading = status.isLoading || fieldStatus.isLoading;\r\n    status.renderable = status.renderable && fieldStatus.renderable;\r\n\r\n    if (!fieldStatus.renderable && !fieldStatus.isLoading) {\r\n      status.fieldsRequiredToRender.add(\r\n        resourceSchemaProp.label || resourceSchemaProp.prop\r\n      );\r\n    }\r\n  }\r\n\r\n  return status;\r\n}\r\n\r\nfunction getCompiledSubcomponents(\r\n  id: string,\r\n  compiledArray: (CompiledComponentConfig | ReactElement)[],\r\n  contextProps: ContextProps,\r\n  schemaProp:\r\n    | ComponentSchemaProp\r\n    | ComponentCollectionSchemaProp\r\n    | ComponentCollectionLocalisedSchemaProp,\r\n  path: string,\r\n  meta: CompilationMetadata,\r\n  isEditing: boolean,\r\n  components: ComponentBuilderProps[\"components\"]\r\n) {\r\n  const originalPath = path;\r\n\r\n  if (schemaProp.type === \"component-collection-localised\") {\r\n    path = path + \".\" + meta.vars.locale;\r\n  }\r\n\r\n  if (schemaProp.noInline) {\r\n    const elements = compiledArray.map((compiledChild, index) =>\r\n      \"_component\" in compiledChild ? (\r\n        <ComponentBuilder\r\n          path={`${path}.${index}`}\r\n          compiled={compiledChild}\r\n          components={components}\r\n        />\r\n      ) : (\r\n        compiledChild\r\n      )\r\n    );\r\n\r\n    if (isSchemaPropComponent(schemaProp)) {\r\n      return elements[0];\r\n    } else {\r\n      return elements;\r\n    }\r\n  }\r\n\r\n  const EditableComponentBuilder = isEditing\r\n    ? components[\"EditableComponentBuilder.editor\"]\r\n    : components[\"EditableComponentBuilder.client\"];\r\n\r\n  let elements = compiledArray.map((compiledChild, index) =>\r\n    \"_component\" in compiledChild ? (\r\n      <EditableComponentBuilder\r\n        compiled={compiledChild}\r\n        index={index}\r\n        length={compiledArray.length}\r\n        path={`${path}.${index}`}\r\n        components={components}\r\n      />\r\n    ) : (\r\n      compiledChild\r\n    )\r\n  );\r\n\r\n  const Placeholder = components[\"Placeholder\"];\r\n\r\n  // TODO: this code should be editor-only\r\n  if (\r\n    isEditing &&\r\n    Placeholder &&\r\n    elements.length === 0 &&\r\n    !contextProps.noInline &&\r\n    // We don't want to show add button for this type\r\n    schemaProp.type !== \"component-collection-localised\"\r\n  ) {\r\n    const type = getComponentMainType(schemaProp.accepts);\r\n\r\n    elements = [\r\n      <Placeholder\r\n        id={id}\r\n        path={path}\r\n        type={type}\r\n        appearance={(schemaProp as ComponentSchemaProp).placeholderAppearance}\r\n        onClick={() => {\r\n          function handleComponentPickerCloseMessage(\r\n            event: ComponentPickerClosedEvent\r\n          ) {\r\n            if (\r\n              event.data.type === \"@easyblocks-editor/component-picker-closed\"\r\n            ) {\r\n              window.removeEventListener(\r\n                \"message\",\r\n                handleComponentPickerCloseMessage\r\n              );\r\n\r\n              if (event.data.payload.config) {\r\n                window.parent.postMessage(\r\n                  itemInserted({\r\n                    name: path,\r\n                    index: 0,\r\n                    block: event.data.payload.config,\r\n                  })\r\n                );\r\n              }\r\n            }\r\n          }\r\n\r\n          window.addEventListener(\"message\", handleComponentPickerCloseMessage);\r\n\r\n          window.parent.postMessage(componentPickerOpened(originalPath));\r\n        }}\r\n        meta={meta}\r\n      />,\r\n    ];\r\n  }\r\n\r\n  if (isSchemaPropComponent(schemaProp)) {\r\n    return elements[0] ?? <Fragment></Fragment>;\r\n  } else {\r\n    return elements;\r\n  }\r\n}\r\nexport type ComponentBuilderProps = {\r\n  path: string;\r\n  passedProps?: {\r\n    [key: string]: any; // any extra props passed in components\r\n  };\r\n  compiled: CompiledComponentConfig;\r\n  components: {\r\n    \"@easyblocks/missing-component\": ComponentType<any>;\r\n    \"@easyblocks/rich-text.client\": ComponentType<any>;\r\n    \"@easyblocks/rich-text-block-element\": ComponentType<any>;\r\n    \"@easyblocks/rich-text-line-element\": ComponentType<any>;\r\n    \"@easyblocks/rich-text-part\": ComponentType<any>;\r\n    \"@easyblocks/text.client\": ComponentType<any>;\r\n    \"EditableComponentBuilder.client\": ComponentType<any>;\r\n    [key: string]: ComponentType<any>;\r\n  };\r\n};\r\n\r\nexport type InternalNoCodeComponentProps = NoCodeComponentProps & {\r\n  __easyblocks: {\r\n    path: string;\r\n    runtime: any;\r\n  };\r\n};\r\n\r\nfunction ComponentBuilder(props: ComponentBuilderProps): ReactElement | null {\r\n  const { compiled, passedProps, path, components, ...restProps } = props;\r\n\r\n  const allPassedProps: Record<string, any> = {\r\n    ...passedProps,\r\n    ...restProps,\r\n  };\r\n\r\n  const meta = useEasyblocksMetadata();\r\n  const externalData = useEasyblocksExternalData();\r\n\r\n  /**\r\n   * Component is build in editing mode only if compiled.__editing is set.\r\n   * This is the result of compilation.\r\n   * The only case when compiled.__editing is set is when we're in Editor and for non-nested components.\r\n   */\r\n  const isEditing = compiled.__editing !== undefined;\r\n  const pathSeparator = path === \"\" ? \"\" : \".\";\r\n\r\n  // Here we know we must render just component, without any wrappers\r\n  const componentDefinition = getComponentDefinition(compiled, {\r\n    definitions: meta.vars.definitions,\r\n  })!;\r\n\r\n  const component = getComponent(componentDefinition, components, isEditing);\r\n  const isMissingComponent =\r\n    compiled._component === \"@easyblocks/missing-component\";\r\n  const isMissingInstance = component === undefined;\r\n  const isMissing = isMissingComponent || isMissingInstance;\r\n  const MissingComponent = components[\"@easyblocks/missing-component\"];\r\n\r\n  if (isMissing) {\r\n    if (!isEditing) {\r\n      return null;\r\n    }\r\n\r\n    if (isMissingComponent) {\r\n      return <MissingComponent error={true}>Missing</MissingComponent>;\r\n    } else {\r\n      console.warn(`Missing \"${compiled._component}\"`);\r\n\r\n      return (\r\n        <MissingComponent component={componentDefinition} error={true}>\r\n          Missing\r\n        </MissingComponent>\r\n      );\r\n    }\r\n  }\r\n\r\n  const Component = component;\r\n\r\n  const renderabilityStatus = getRenderabilityStatus(\r\n    compiled,\r\n    meta,\r\n    externalData\r\n  );\r\n\r\n  if (!renderabilityStatus.renderable) {\r\n    const fieldsRequiredToRender = Array.from(\r\n      renderabilityStatus.fieldsRequiredToRender\r\n    );\r\n\r\n    return (\r\n      <MissingComponent component={componentDefinition}>\r\n        {`Fill following fields to render the component: ${fieldsRequiredToRender.join(\r\n          \", \"\r\n        )}`}\r\n\r\n        {renderabilityStatus.isLoading && (\r\n          <Fragment>\r\n            <br />\r\n            <br />\r\n            Loading data...\r\n          </Fragment>\r\n        )}\r\n      </MissingComponent>\r\n    );\r\n  }\r\n\r\n  const shopstoryCompiledConfig = compiled as CompiledShopstoryComponentConfig;\r\n\r\n  // Shopstory component\r\n  const styled: { [key: string]: any } = buildBoxes(\r\n    shopstoryCompiledConfig.styled,\r\n    \"\",\r\n    {},\r\n    meta\r\n  );\r\n\r\n  // Styled\r\n  componentDefinition.schema.forEach((schemaProp) => {\r\n    if (isSchemaPropComponentOrComponentCollection(schemaProp)) {\r\n      const contextProps =\r\n        shopstoryCompiledConfig.__editing?.components?.[schemaProp.prop] || {};\r\n\r\n      const compiledChildren =\r\n        shopstoryCompiledConfig.components[schemaProp.prop];\r\n\r\n      styled[schemaProp.prop] = getCompiledSubcomponents(\r\n        compiled._id,\r\n        compiledChildren,\r\n        contextProps,\r\n        schemaProp,\r\n        `${path}${pathSeparator}${schemaProp.prop}`,\r\n        meta,\r\n        isEditing,\r\n        components\r\n      );\r\n    }\r\n  });\r\n\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n  const { ref, __isSelected, ...restPassedProps } = allPassedProps || {};\r\n\r\n  const runtime = {\r\n    stitches: meta.stitches,\r\n    resop: resop,\r\n    devices: meta.vars.devices,\r\n  };\r\n\r\n  const easyblocksProp: InternalNoCodeComponentProps[\"__easyblocks\"] = {\r\n    id: shopstoryCompiledConfig._id,\r\n    isEditing,\r\n    path,\r\n    runtime,\r\n    isSelected: __isSelected,\r\n  };\r\n\r\n  const componentProps = {\r\n    ...restPassedProps,\r\n    ...mapExternalProps(\r\n      shopstoryCompiledConfig.props,\r\n      shopstoryCompiledConfig._id,\r\n      componentDefinition,\r\n      externalData\r\n    ),\r\n    ...styled,\r\n    __easyblocks: easyblocksProp,\r\n  };\r\n\r\n  return <Component {...componentProps} />;\r\n}\r\n\r\nfunction getComponent(\r\n  componentDefinition: InternalComponentDefinition,\r\n  components: ComponentBuilderProps[\"components\"],\r\n  isEditing: boolean\r\n) {\r\n  let component: any;\r\n\r\n  // We first try to find editor version of that component\r\n  if (isEditing) {\r\n    component = components[componentDefinition.id + \".editor\"];\r\n  }\r\n\r\n  // If it still missing, we try to find client version of that component\r\n  if (!component) {\r\n    component = components[componentDefinition.id + \".client\"];\r\n  }\r\n\r\n  if (!component) {\r\n    // In most cases we're going to pick component by its id\r\n    component = components[componentDefinition.id];\r\n  }\r\n\r\n  return component;\r\n}\r\n\r\nfunction mapExternalProps(\r\n  props: Record<string, unknown>,\r\n  configId: string,\r\n  componentDefinition: InternalComponentDefinition,\r\n  externalData: ExternalData\r\n) {\r\n  const resultsProps: Record<string, unknown> = {};\r\n\r\n  for (const propName in props) {\r\n    const schemaProp = componentDefinition.schema.find(\r\n      (currentSchema) => currentSchema.prop === propName\r\n    );\r\n\r\n    if (schemaProp) {\r\n      const propValue = props[propName] as ResponsiveValue<\r\n        LocalReference | ExternalReference\r\n      >;\r\n\r\n      if (\r\n        schemaProp.type === \"text\" &&\r\n        isLocalTextReference(propValue as LocalTextReference, \"text\")\r\n      ) {\r\n        resultsProps[propName] = (\r\n          propValue as unknown as CompiledLocalTextReference\r\n        ).value;\r\n      } else if (\r\n        // FIXME: this is a mess\r\n        (!isTrulyResponsiveValue(propValue) &&\r\n          typeof propValue === \"object\" &&\r\n          \"id\" in propValue &&\r\n          \"widgetId\" in propValue &&\r\n          !(\"value\" in propValue)) ||\r\n        (isTrulyResponsiveValue(propValue) &&\r\n          responsiveValueValues(propValue).every(\r\n            (v) =>\r\n              typeof v === \"object\" &&\r\n              v &&\r\n              \"id\" in v &&\r\n              \"widgetId\" in v &&\r\n              !(\"value\" in v)\r\n          ))\r\n      ) {\r\n        resultsProps[propName] = resolveExternalValue(\r\n          propValue,\r\n          configId,\r\n          schemaProp as ExternalSchemaProp,\r\n          externalData\r\n        );\r\n      } else {\r\n        resultsProps[propName] = props[propName];\r\n      }\r\n    } else {\r\n      resultsProps[propName] = props[propName];\r\n    }\r\n  }\r\n\r\n  return resultsProps;\r\n}\r\n\r\nexport { ComponentBuilder };\r\n\r\nfunction getFieldStatus(\r\n  externalReference: ResponsiveValue<ExternalReference>,\r\n  externalData: ExternalData,\r\n  configId: string,\r\n  fieldName: string,\r\n  devices: Devices\r\n) {\r\n  return responsiveValueReduce(\r\n    externalReference,\r\n    (currentStatus, value: any, deviceId) => {\r\n      if (!deviceId) {\r\n        if (!value.id) {\r\n          return {\r\n            isLoading: false,\r\n            renderable: false,\r\n          };\r\n        }\r\n\r\n        const externalValue = getResolvedExternalDataValue(\r\n          externalData,\r\n          configId,\r\n          fieldName,\r\n          value\r\n        );\r\n\r\n        return {\r\n          isLoading: currentStatus.isLoading || externalValue === undefined,\r\n          renderable:\r\n            currentStatus.renderable &&\r\n            externalValue !== undefined &&\r\n            (externalValue.type === \"object\" ? value.key !== undefined : true),\r\n        };\r\n      }\r\n\r\n      if (currentStatus.isLoading || !currentStatus.renderable) {\r\n        return currentStatus;\r\n      }\r\n\r\n      const externalReferenceValue = responsiveValueGetDefinedValue(\r\n        value,\r\n        deviceId,\r\n        devices\r\n      );\r\n\r\n      if (!externalReferenceValue || externalReferenceValue.id === null) {\r\n        return {\r\n          isLoading: false,\r\n          renderable: false,\r\n        };\r\n      }\r\n\r\n      const externalValue = getResolvedExternalDataValue(\r\n        externalData,\r\n        configId,\r\n        fieldName,\r\n        externalReferenceValue\r\n      );\r\n\r\n      return {\r\n        isLoading: currentStatus.isLoading || externalValue === undefined,\r\n        renderable:\r\n          currentStatus.renderable &&\r\n          externalValue !== undefined &&\r\n          (externalValue.type === \"object\"\r\n            ? externalReferenceValue.key !== undefined\r\n            : true),\r\n      };\r\n    },\r\n    { renderable: true, isLoading: false },\r\n    devices\r\n  );\r\n}\r\n\r\nfunction getComponentMainType(componentTypes: string[]) {\r\n  let type;\r\n\r\n  if (\r\n    componentTypes.includes(\"action\") ||\r\n    componentTypes.includes(\"actionLink\")\r\n  ) {\r\n    type = \"action\";\r\n  } else if (componentTypes.includes(\"card\")) {\r\n    type = \"card\";\r\n  } else if (componentTypes.includes(\"symbol\")) {\r\n    type = \"icon\";\r\n  } else if (componentTypes.includes(\"button\")) {\r\n    type = \"button\";\r\n  } else if (\r\n    componentTypes.includes(\"section\") ||\r\n    componentTypes.includes(\"token\")\r\n  ) {\r\n    type = \"section\";\r\n  } else if (componentTypes.includes(\"item\")) {\r\n    type = \"item\";\r\n  } else if (\r\n    componentTypes.includes(\"image\") ||\r\n    componentTypes.includes(\"$image\")\r\n  ) {\r\n    type = \"image\";\r\n  } else if (componentTypes.includes(\"actionTextModifier\")) {\r\n    type = \"actionTextModifier\";\r\n  } else {\r\n    type = \"item\";\r\n  }\r\n\r\n  return type;\r\n}\r\n"],"names":["buildBoxes","compiled","name","actionWrappers","meta","Array","isArray","map","x","index","__isBox","boxProps","__compiled","__name","devices","vars","stitches","React","createElement","Box","ret","key","getComponentDefinition","runtimeContext","findComponentDefinitionById","_component","getRenderabilityStatus","externalData","status","renderable","isLoading","fieldsRequiredToRender","Set","componentDefinition","definitions","requiredExternalFields","schema","filter","schemaProp","type","propValue","props","prop","optional","length","resourceSchemaProp","externalReference","fieldStatus","getFieldStatus","_id","add","label","getCompiledSubcomponents","id","compiledArray","contextProps","path","isEditing","components","originalPath","locale","noInline","elements","compiledChild","ComponentBuilder","isSchemaPropComponent","EditableComponentBuilder","Placeholder","getComponentMainType","accepts","appearance","placeholderAppearance","onClick","handleComponentPickerCloseMessage","event","data","window","removeEventListener","payload","config","parent","postMessage","itemInserted","block","addEventListener","componentPickerOpened","Fragment","passedProps","restProps","allPassedProps","useEasyblocksMetadata","useEasyblocksExternalData","__editing","undefined","pathSeparator","component","getComponent","isMissingComponent","isMissingInstance","isMissing","MissingComponent","error","console","warn","Component","renderabilityStatus","from","join","shopstoryCompiledConfig","styled","forEach","isSchemaPropComponentOrComponentCollection","compiledChildren","ref","__isSelected","restPassedProps","runtime","resop","easyblocksProp","isSelected","componentProps","mapExternalProps","__easyblocks","configId","resultsProps","propName","find","currentSchema","isLocalTextReference","value","isTrulyResponsiveValue","responsiveValueValues","every","v","resolveExternalValue","fieldName","responsiveValueReduce","currentStatus","deviceId","externalValue","getResolvedExternalDataValue","externalReferenceValue","responsiveValueGetDefinedValue","componentTypes","includes"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAgDA,SAASA,UAAUA,CACjBC,QAAa,EACbC,IAAY,EACZC,cAAsC,EACtCC,IAAS,EACJ;AACL,EAAA,IAAIC,KAAK,CAACC,OAAO,CAACL,QAAQ,CAAC,EAAE;IAC3B,OAAOA,QAAQ,CAACM,GAAG,CAAC,CAACC,CAAM,EAAEC,KAAa,KACxCT,UAAU,CAACQ,CAAC,EAAE,CAAA,EAAGN,IAAI,CAAA,CAAA,EAAIO,KAAK,CAAA,CAAE,EAAEN,cAAc,EAAEC,IAAI,CACxD,CAAC,CAAA;GACF,MAAM,IAAI,OAAOH,QAAQ,KAAK,QAAQ,IAAIA,QAAQ,KAAK,IAAI,EAAE;IAC5D,IAAIA,QAAQ,CAACS,OAAO,EAAE;AACpB,MAAA,MAAMC,QAAQ,GAAG;AACfC,QAAAA,UAAU,EAAEX,QAAQ;AACpBY,QAAAA,MAAM,EAAEX,IAAI;AACZY,QAAAA,OAAO,EAAEV,IAAI,CAACW,IAAI,CAACD,OAAO;QAC1BE,QAAQ,EAAEZ,IAAI,CAACY,QAAAA;OAChB,CAAA;AAED,MAAA,oBAAOC,yBAAA,CAAAC,aAAA,CAACC,OAAG,EAAKR,QAAW,CAAC,CAAA;AAC9B,KAAA;IAEA,MAAMS,GAAwB,GAAG,EAAE,CAAA;AAEnC,IAAA,KAAK,MAAMC,GAAG,IAAIpB,QAAQ,EAAE;AAC1BmB,MAAAA,GAAG,CAACC,GAAG,CAAC,GAAGrB,UAAU,CAACC,QAAQ,CAACoB,GAAG,CAAC,EAAEA,GAAG,EAAElB,cAAc,EAAEC,IAAI,CAAC,CAAA;AACjE,KAAA;AACA,IAAA,OAAOgB,GAAG,CAAA;AACZ,GAAA;AACA,EAAA,OAAOnB,QAAQ,CAAA;AACjB,CAAA;AAEA,SAASqB,sBAAsBA,CAC7BrB,QAAiC,EACjCsB,cAAmB,EACnB;AACA,EAAA,OAAOC,mDAA2B,CAACvB,QAAQ,CAACwB,UAAU,EAAEF,cAAc,CAAC,CAAA;AACzE,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAQA,SAASG,sBAAsBA,CAC7BzB,QAAiC,EACjCG,IAAyB,EACzBuB,YAA0B,EACL;AACrB,EAAA,MAAMC,MAA2B,GAAG;AAClCC,IAAAA,UAAU,EAAE,IAAI;AAChBC,IAAAA,SAAS,EAAE,KAAK;IAChBC,sBAAsB,EAAE,IAAIC,GAAG,EAAS;GACzC,CAAA;AAED,EAAA,MAAMC,mBAAmB,GAAGX,sBAAsB,CAACrB,QAAQ,EAAE;AAC3DiC,IAAAA,WAAW,EAAE9B,IAAI,CAACW,IAAI,CAACmB,WAAAA;AACzB,GAAC,CAAC,CAAA;EAEF,IAAI,CAACD,mBAAmB,EAAE;IACxB,OAAO;AACLJ,MAAAA,UAAU,EAAE,KAAK;AACjBC,MAAAA,SAAS,EAAE,KAAK;MAChBC,sBAAsB,EAAE,IAAIC,GAAG,EAAS;KACzC,CAAA;AACH,GAAA;EAEA,MAAMG,sBAAsB,GAAGF,mBAAmB,CAACG,MAAM,CAACC,MAAM,CAC7DC,UAAU,IAAuC;AAChD,IAAA,IAAIA,UAAU,CAACC,IAAI,KAAK,MAAM,EAAE;AAC9B,MAAA,OAAO,KAAK,CAAA;AACd,KAAA;IAEA,MAAMC,SAAS,GAAGvC,QAAQ,CAACwC,KAAK,CAACH,UAAU,CAACI,IAAI,CAAC,CAAA;AAEjD,IAAA,IACE,OAAOF,SAAS,KAAK,QAAQ,IAC7BA,SAAS,KAAK,IAAI,IAClB,IAAI,IAAIA,SAAS,IACjB,UAAU,IAAIA,SAAS,EACvB;MACA,IAAI,UAAU,IAAIF,UAAU,EAAE;QAC5B,OAAO,CAACA,UAAU,CAACK,QAAQ,CAAA;AAC7B,OAAA;AAEA,MAAA,OAAO,IAAI,CAAA;AACb,KAAA;AAEA,IAAA,OAAO,KAAK,CAAA;AACd,GACF,CAAC,CAAA;AAED,EAAA,IAAIR,sBAAsB,CAACS,MAAM,KAAK,CAAC,EAAE;AACvC,IAAA,OAAOhB,MAAM,CAAA;AACf,GAAA;AAEA,EAAA,KAAK,MAAMiB,kBAAkB,IAAIV,sBAAsB,EAAE;IACvD,MAAMW,iBAAqD,GACzD7C,QAAQ,CAACwC,KAAK,CAACI,kBAAkB,CAACH,IAAI,CAAC,CAAA;IAEzC,MAAMK,WAAW,GAAGC,cAAc,CAChCF,iBAAiB,EACjBnB,YAAY,EACZ1B,QAAQ,CAACgD,GAAG,EACZJ,kBAAkB,CAACH,IAAI,EACvBtC,IAAI,CAACW,IAAI,CAACD,OACZ,CAAC,CAAA;IAEDc,MAAM,CAACE,SAAS,GAAGF,MAAM,CAACE,SAAS,IAAIiB,WAAW,CAACjB,SAAS,CAAA;IAC5DF,MAAM,CAACC,UAAU,GAAGD,MAAM,CAACC,UAAU,IAAIkB,WAAW,CAAClB,UAAU,CAAA;IAE/D,IAAI,CAACkB,WAAW,CAAClB,UAAU,IAAI,CAACkB,WAAW,CAACjB,SAAS,EAAE;AACrDF,MAAAA,MAAM,CAACG,sBAAsB,CAACmB,GAAG,CAC/BL,kBAAkB,CAACM,KAAK,IAAIN,kBAAkB,CAACH,IACjD,CAAC,CAAA;AACH,KAAA;AACF,GAAA;AAEA,EAAA,OAAOd,MAAM,CAAA;AACf,CAAA;AAEA,SAASwB,wBAAwBA,CAC/BC,EAAU,EACVC,aAAyD,EACzDC,YAA0B,EAC1BjB,UAG0C,EAC1CkB,IAAY,EACZpD,IAAyB,EACzBqD,SAAkB,EAClBC,UAA+C,EAC/C;EACA,MAAMC,YAAY,GAAGH,IAAI,CAAA;AAEzB,EAAA,IAAIlB,UAAU,CAACC,IAAI,KAAK,gCAAgC,EAAE;IACxDiB,IAAI,GAAGA,IAAI,GAAG,GAAG,GAAGpD,IAAI,CAACW,IAAI,CAAC6C,MAAM,CAAA;AACtC,GAAA;EAEA,IAAItB,UAAU,CAACuB,QAAQ,EAAE;AACvB,IAAA,MAAMC,QAAQ,GAAGR,aAAa,CAAC/C,GAAG,CAAC,CAACwD,aAAa,EAAEtD,KAAK,KACtD,YAAY,IAAIsD,aAAa,gBAC3B9C,yBAAA,CAAAC,aAAA,CAAC8C,gBAAgB,EAAA;AACfR,MAAAA,IAAI,EAAE,CAAA,EAAGA,IAAI,CAAA,CAAA,EAAI/C,KAAK,CAAG,CAAA;AACzBR,MAAAA,QAAQ,EAAE8D,aAAc;AACxBL,MAAAA,UAAU,EAAEA,UAAAA;KACb,CAAC,GAEFK,aAEJ,CAAC,CAAA;AAED,IAAA,IAAIE,2BAAqB,CAAC3B,UAAU,CAAC,EAAE;MACrC,OAAOwB,QAAQ,CAAC,CAAC,CAAC,CAAA;AACpB,KAAC,MAAM;AACL,MAAA,OAAOA,QAAQ,CAAA;AACjB,KAAA;AACF,GAAA;AAEA,EAAA,MAAMI,wBAAwB,GAAGT,SAAS,GACtCC,UAAU,CAAC,iCAAiC,CAAC,GAC7CA,UAAU,CAAC,iCAAiC,CAAC,CAAA;AAEjD,EAAA,IAAII,QAAQ,GAAGR,aAAa,CAAC/C,GAAG,CAAC,CAACwD,aAAa,EAAEtD,KAAK,KACpD,YAAY,IAAIsD,aAAa,gBAC3B9C,yBAAA,CAAAC,aAAA,CAACgD,wBAAwB,EAAA;AACvBjE,IAAAA,QAAQ,EAAE8D,aAAc;AACxBtD,IAAAA,KAAK,EAAEA,KAAM;IACbmC,MAAM,EAAEU,aAAa,CAACV,MAAO;AAC7BY,IAAAA,IAAI,EAAE,CAAA,EAAGA,IAAI,CAAA,CAAA,EAAI/C,KAAK,CAAG,CAAA;AACzBiD,IAAAA,UAAU,EAAEA,UAAAA;GACb,CAAC,GAEFK,aAEJ,CAAC,CAAA;AAED,EAAA,MAAMI,WAAW,GAAGT,UAAU,CAAC,aAAa,CAAC,CAAA;;AAE7C;AACA,EAAA,IACED,SAAS,IACTU,WAAW,IACXL,QAAQ,CAAClB,MAAM,KAAK,CAAC,IACrB,CAACW,YAAY,CAACM,QAAQ;AACtB;AACAvB,EAAAA,UAAU,CAACC,IAAI,KAAK,gCAAgC,EACpD;AACA,IAAA,MAAMA,IAAI,GAAG6B,oBAAoB,CAAC9B,UAAU,CAAC+B,OAAO,CAAC,CAAA;AAErDP,IAAAA,QAAQ,GAAG,cACT7C,yBAAA,CAAAC,aAAA,CAACiD,WAAW,EAAA;AACVd,MAAAA,EAAE,EAAEA,EAAG;AACPG,MAAAA,IAAI,EAAEA,IAAK;AACXjB,MAAAA,IAAI,EAAEA,IAAK;MACX+B,UAAU,EAAGhC,UAAU,CAAyBiC,qBAAsB;MACtEC,OAAO,EAAEA,MAAM;QACb,SAASC,iCAAiCA,CACxCC,KAAiC,EACjC;AACA,UAAA,IACEA,KAAK,CAACC,IAAI,CAACpC,IAAI,KAAK,4CAA4C,EAChE;AACAqC,YAAAA,MAAM,CAACC,mBAAmB,CACxB,SAAS,EACTJ,iCACF,CAAC,CAAA;AAED,YAAA,IAAIC,KAAK,CAACC,IAAI,CAACG,OAAO,CAACC,MAAM,EAAE;AAC7BH,cAAAA,MAAM,CAACI,MAAM,CAACC,WAAW,CACvBC,mBAAY,CAAC;AACXhF,gBAAAA,IAAI,EAAEsD,IAAI;AACV/C,gBAAAA,KAAK,EAAE,CAAC;AACR0E,gBAAAA,KAAK,EAAET,KAAK,CAACC,IAAI,CAACG,OAAO,CAACC,MAAAA;AAC5B,eAAC,CACH,CAAC,CAAA;AACH,aAAA;AACF,WAAA;AACF,SAAA;AAEAH,QAAAA,MAAM,CAACQ,gBAAgB,CAAC,SAAS,EAAEX,iCAAiC,CAAC,CAAA;QAErEG,MAAM,CAACI,MAAM,CAACC,WAAW,CAACI,4BAAqB,CAAC1B,YAAY,CAAC,CAAC,CAAA;OAC9D;AACFvD,MAAAA,IAAI,EAAEA,IAAAA;AAAK,KACZ,CAAC,CACH,CAAA;AACH,GAAA;AAEA,EAAA,IAAI6D,2BAAqB,CAAC3B,UAAU,CAAC,EAAE;IACrC,OAAOwB,QAAQ,CAAC,CAAC,CAAC,iBAAI7C,yBAAA,CAAAC,aAAA,CAACoE,cAAQ,EAAA,IAAW,CAAC,CAAA;AAC7C,GAAC,MAAM;AACL,IAAA,OAAOxB,QAAQ,CAAA;AACjB,GAAA;AACF,CAAA;AA0BA,SAASE,gBAAgBA,CAACvB,KAA4B,EAAuB;EAC3E,MAAM;IAAExC,QAAQ;IAAEsF,WAAW;IAAE/B,IAAI;IAAEE,UAAU;IAAE,GAAG8B,SAAAA;AAAU,GAAC,GAAG/C,KAAK,CAAA;AAEvE,EAAA,MAAMgD,cAAmC,GAAG;AAC1C,IAAA,GAAGF,WAAW;IACd,GAAGC,SAAAA;GACJ,CAAA;AAED,EAAA,MAAMpF,IAAI,GAAGsF,gDAAqB,EAAE,CAAA;AACpC,EAAA,MAAM/D,YAAY,GAAGgE,wDAAyB,EAAE,CAAA;;AAEhD;AACF;AACA;AACA;AACA;AACE,EAAA,MAAMlC,SAAS,GAAGxD,QAAQ,CAAC2F,SAAS,KAAKC,SAAS,CAAA;EAClD,MAAMC,aAAa,GAAGtC,IAAI,KAAK,EAAE,GAAG,EAAE,GAAG,GAAG,CAAA;;AAE5C;AACA,EAAA,MAAMvB,mBAAmB,GAAGX,sBAAsB,CAACrB,QAAQ,EAAE;AAC3DiC,IAAAA,WAAW,EAAE9B,IAAI,CAACW,IAAI,CAACmB,WAAAA;AACzB,GAAC,CAAE,CAAA;EAEH,MAAM6D,SAAS,GAAGC,YAAY,CAAC/D,mBAAmB,EAAEyB,UAAU,EAAED,SAAS,CAAC,CAAA;AAC1E,EAAA,MAAMwC,kBAAkB,GACtBhG,QAAQ,CAACwB,UAAU,KAAK,+BAA+B,CAAA;AACzD,EAAA,MAAMyE,iBAAiB,GAAGH,SAAS,KAAKF,SAAS,CAAA;AACjD,EAAA,MAAMM,SAAS,GAAGF,kBAAkB,IAAIC,iBAAiB,CAAA;AACzD,EAAA,MAAME,gBAAgB,GAAG1C,UAAU,CAAC,+BAA+B,CAAC,CAAA;AAEpE,EAAA,IAAIyC,SAAS,EAAE;IACb,IAAI,CAAC1C,SAAS,EAAE;AACd,MAAA,OAAO,IAAI,CAAA;AACb,KAAA;AAEA,IAAA,IAAIwC,kBAAkB,EAAE;AACtB,MAAA,oBAAOhF,yBAAA,CAAAC,aAAA,CAACkF,gBAAgB,EAAA;AAACC,QAAAA,KAAK,EAAE,IAAA;AAAK,OAAA,EAAC,SAAyB,CAAC,CAAA;AAClE,KAAC,MAAM;MACLC,OAAO,CAACC,IAAI,CAAC,CAAA,SAAA,EAAYtG,QAAQ,CAACwB,UAAU,GAAG,CAAC,CAAA;AAEhD,MAAA,oBACER,yBAAA,CAAAC,aAAA,CAACkF,gBAAgB,EAAA;AAACL,QAAAA,SAAS,EAAE9D,mBAAoB;AAACoE,QAAAA,KAAK,EAAE,IAAA;AAAK,OAAA,EAAC,SAE7C,CAAC,CAAA;AAEvB,KAAA;AACF,GAAA;EAEA,MAAMG,SAAS,GAAGT,SAAS,CAAA;EAE3B,MAAMU,mBAAmB,GAAG/E,sBAAsB,CAChDzB,QAAQ,EACRG,IAAI,EACJuB,YACF,CAAC,CAAA;AAED,EAAA,IAAI,CAAC8E,mBAAmB,CAAC5E,UAAU,EAAE;IACnC,MAAME,sBAAsB,GAAG1B,KAAK,CAACqG,IAAI,CACvCD,mBAAmB,CAAC1E,sBACtB,CAAC,CAAA;AAED,IAAA,oBACEd,yBAAA,CAAAC,aAAA,CAACkF,gBAAgB,EAAA;AAACL,MAAAA,SAAS,EAAE9D,mBAAAA;AAAoB,KAAA,EAC9C,CAAkDF,+CAAAA,EAAAA,sBAAsB,CAAC4E,IAAI,CAC5E,IACF,CAAC,CAAE,CAAA,EAEFF,mBAAmB,CAAC3E,SAAS,iBAC5Bb,yBAAA,CAAAC,aAAA,CAACoE,cAAQ,EACPrE,IAAAA,eAAAA,yBAAA,CAAAC,aAAA,WAAK,CAAC,eACND,yBAAA,CAAAC,aAAA,CAAA,IAAA,EAAA,IAAK,CAAC,EAAA,iBAEE,CAEI,CAAC,CAAA;AAEvB,GAAA;EAEA,MAAM0F,uBAAuB,GAAG3G,QAA4C,CAAA;;AAE5E;AACA,EAAA,MAAM4G,MAA8B,GAAG7G,UAAU,CAC/C4G,uBAAuB,CAACC,MAAM,EAC9B,EAAE,EACF,EAAE,EACFzG,IACF,CAAC,CAAA;;AAED;AACA6B,EAAAA,mBAAmB,CAACG,MAAM,CAAC0E,OAAO,CAAExE,UAAU,IAAK;AACjD,IAAA,IAAIyE,gDAA0C,CAACzE,UAAU,CAAC,EAAE;AAC1D,MAAA,MAAMiB,YAAY,GAChBqD,uBAAuB,CAAChB,SAAS,EAAElC,UAAU,GAAGpB,UAAU,CAACI,IAAI,CAAC,IAAI,EAAE,CAAA;MAExE,MAAMsE,gBAAgB,GACpBJ,uBAAuB,CAAClD,UAAU,CAACpB,UAAU,CAACI,IAAI,CAAC,CAAA;AAErDmE,MAAAA,MAAM,CAACvE,UAAU,CAACI,IAAI,CAAC,GAAGU,wBAAwB,CAChDnD,QAAQ,CAACgD,GAAG,EACZ+D,gBAAgB,EAChBzD,YAAY,EACZjB,UAAU,EACV,CAAGkB,EAAAA,IAAI,CAAGsC,EAAAA,aAAa,GAAGxD,UAAU,CAACI,IAAI,CAAA,CAAE,EAC3CtC,IAAI,EACJqD,SAAS,EACTC,UACF,CAAC,CAAA;AACH,KAAA;AACF,GAAC,CAAC,CAAA;;AAEF;EACA,MAAM;IAAEuD,GAAG;IAAEC,YAAY;IAAE,GAAGC,eAAAA;AAAgB,GAAC,GAAG1B,cAAc,IAAI,EAAE,CAAA;AAEtE,EAAA,MAAM2B,OAAO,GAAG;IACdpG,QAAQ,EAAEZ,IAAI,CAACY,QAAQ;AACvBqG,IAAAA,KAAK,EAAEA,WAAK;AACZvG,IAAAA,OAAO,EAAEV,IAAI,CAACW,IAAI,CAACD,OAAAA;GACpB,CAAA;AAED,EAAA,MAAMwG,cAA4D,GAAG;IACnEjE,EAAE,EAAEuD,uBAAuB,CAAC3D,GAAG;IAC/BQ,SAAS;IACTD,IAAI;IACJ4D,OAAO;AACPG,IAAAA,UAAU,EAAEL,YAAAA;GACb,CAAA;AAED,EAAA,MAAMM,cAAc,GAAG;AACrB,IAAA,GAAGL,eAAe;AAClB,IAAA,GAAGM,gBAAgB,CACjBb,uBAAuB,CAACnE,KAAK,EAC7BmE,uBAAuB,CAAC3D,GAAG,EAC3BhB,mBAAmB,EACnBN,YACF,CAAC;AACD,IAAA,GAAGkF,MAAM;AACTa,IAAAA,YAAY,EAAEJ,cAAAA;GACf,CAAA;AAED,EAAA,oBAAOrG,yBAAA,CAAAC,aAAA,CAACsF,SAAS,EAAKgB,cAAiB,CAAC,CAAA;AAC1C,CAAA;AAEA,SAASxB,YAAYA,CACnB/D,mBAAgD,EAChDyB,UAA+C,EAC/CD,SAAkB,EAClB;AACA,EAAA,IAAIsC,SAAc,CAAA;;AAElB;AACA,EAAA,IAAItC,SAAS,EAAE;IACbsC,SAAS,GAAGrC,UAAU,CAACzB,mBAAmB,CAACoB,EAAE,GAAG,SAAS,CAAC,CAAA;AAC5D,GAAA;;AAEA;EACA,IAAI,CAAC0C,SAAS,EAAE;IACdA,SAAS,GAAGrC,UAAU,CAACzB,mBAAmB,CAACoB,EAAE,GAAG,SAAS,CAAC,CAAA;AAC5D,GAAA;EAEA,IAAI,CAAC0C,SAAS,EAAE;AACd;AACAA,IAAAA,SAAS,GAAGrC,UAAU,CAACzB,mBAAmB,CAACoB,EAAE,CAAC,CAAA;AAChD,GAAA;AAEA,EAAA,OAAO0C,SAAS,CAAA;AAClB,CAAA;AAEA,SAAS0B,gBAAgBA,CACvBhF,KAA8B,EAC9BkF,QAAgB,EAChB1F,mBAAgD,EAChDN,YAA0B,EAC1B;EACA,MAAMiG,YAAqC,GAAG,EAAE,CAAA;AAEhD,EAAA,KAAK,MAAMC,QAAQ,IAAIpF,KAAK,EAAE;AAC5B,IAAA,MAAMH,UAAU,GAAGL,mBAAmB,CAACG,MAAM,CAAC0F,IAAI,CAC/CC,aAAa,IAAKA,aAAa,CAACrF,IAAI,KAAKmF,QAC5C,CAAC,CAAA;AAED,IAAA,IAAIvF,UAAU,EAAE;AACd,MAAA,MAAME,SAAS,GAAGC,KAAK,CAACoF,QAAQ,CAE/B,CAAA;AAED,MAAA,IACEvF,UAAU,CAACC,IAAI,KAAK,MAAM,IAC1ByF,mCAAoB,CAACxF,SAAS,EAAwB,MAAM,CAAC,EAC7D;AACAoF,QAAAA,YAAY,CAACC,QAAQ,CAAC,GACpBrF,SAAS,CACTyF,KAAK,CAAA;AACT,OAAC,MAAM;AACL;MACC,CAACC,6CAAsB,CAAC1F,SAAS,CAAC,IACjC,OAAOA,SAAS,KAAK,QAAQ,IAC7B,IAAI,IAAIA,SAAS,IACjB,UAAU,IAAIA,SAAS,IACvB,EAAE,OAAO,IAAIA,SAAS,CAAC,IACxB0F,6CAAsB,CAAC1F,SAAS,CAAC,IAChC2F,2CAAqB,CAAC3F,SAAS,CAAC,CAAC4F,KAAK,CACnCC,CAAC,IACA,OAAOA,CAAC,KAAK,QAAQ,IACrBA,CAAC,IACD,IAAI,IAAIA,CAAC,IACT,UAAU,IAAIA,CAAC,IACf,EAAE,OAAO,IAAIA,CAAC,CAClB,CAAE,EACJ;AACAT,QAAAA,YAAY,CAACC,QAAQ,CAAC,GAAGS,mCAAoB,CAC3C9F,SAAS,EACTmF,QAAQ,EACRrF,UAAU,EACVX,YACF,CAAC,CAAA;AACH,OAAC,MAAM;AACLiG,QAAAA,YAAY,CAACC,QAAQ,CAAC,GAAGpF,KAAK,CAACoF,QAAQ,CAAC,CAAA;AAC1C,OAAA;AACF,KAAC,MAAM;AACLD,MAAAA,YAAY,CAACC,QAAQ,CAAC,GAAGpF,KAAK,CAACoF,QAAQ,CAAC,CAAA;AAC1C,KAAA;AACF,GAAA;AAEA,EAAA,OAAOD,YAAY,CAAA;AACrB,CAAA;AAIA,SAAS5E,cAAcA,CACrBF,iBAAqD,EACrDnB,YAA0B,EAC1BgG,QAAgB,EAChBY,SAAiB,EACjBzH,OAAgB,EAChB;EACA,OAAO0H,2CAAqB,CAC1B1F,iBAAiB,EACjB,CAAC2F,aAAa,EAAER,KAAU,EAAES,QAAQ,KAAK;IACvC,IAAI,CAACA,QAAQ,EAAE;AACb,MAAA,IAAI,CAACT,KAAK,CAAC5E,EAAE,EAAE;QACb,OAAO;AACLvB,UAAAA,SAAS,EAAE,KAAK;AAChBD,UAAAA,UAAU,EAAE,KAAA;SACb,CAAA;AACH,OAAA;MAEA,MAAM8G,aAAa,GAAGC,2CAA4B,CAChDjH,YAAY,EACZgG,QAAQ,EACRY,SAAS,EACTN,KACF,CAAC,CAAA;MAED,OAAO;AACLnG,QAAAA,SAAS,EAAE2G,aAAa,CAAC3G,SAAS,IAAI6G,aAAa,KAAK9C,SAAS;QACjEhE,UAAU,EACR4G,aAAa,CAAC5G,UAAU,IACxB8G,aAAa,KAAK9C,SAAS,KAC1B8C,aAAa,CAACpG,IAAI,KAAK,QAAQ,GAAG0F,KAAK,CAAC5G,GAAG,KAAKwE,SAAS,GAAG,IAAI,CAAA;OACpE,CAAA;AACH,KAAA;IAEA,IAAI4C,aAAa,CAAC3G,SAAS,IAAI,CAAC2G,aAAa,CAAC5G,UAAU,EAAE;AACxD,MAAA,OAAO4G,aAAa,CAAA;AACtB,KAAA;IAEA,MAAMI,sBAAsB,GAAGC,6DAA8B,CAC3Db,KAAK,EACLS,QAAQ,EACR5H,OACF,CAAC,CAAA;IAED,IAAI,CAAC+H,sBAAsB,IAAIA,sBAAsB,CAACxF,EAAE,KAAK,IAAI,EAAE;MACjE,OAAO;AACLvB,QAAAA,SAAS,EAAE,KAAK;AAChBD,QAAAA,UAAU,EAAE,KAAA;OACb,CAAA;AACH,KAAA;IAEA,MAAM8G,aAAa,GAAGC,2CAA4B,CAChDjH,YAAY,EACZgG,QAAQ,EACRY,SAAS,EACTM,sBACF,CAAC,CAAA;IAED,OAAO;AACL/G,MAAAA,SAAS,EAAE2G,aAAa,CAAC3G,SAAS,IAAI6G,aAAa,KAAK9C,SAAS;MACjEhE,UAAU,EACR4G,aAAa,CAAC5G,UAAU,IACxB8G,aAAa,KAAK9C,SAAS,KAC1B8C,aAAa,CAACpG,IAAI,KAAK,QAAQ,GAC5BsG,sBAAsB,CAACxH,GAAG,KAAKwE,SAAS,GACxC,IAAI,CAAA;KACX,CAAA;AACH,GAAC,EACD;AAAEhE,IAAAA,UAAU,EAAE,IAAI;AAAEC,IAAAA,SAAS,EAAE,KAAA;GAAO,EACtChB,OACF,CAAC,CAAA;AACH,CAAA;AAEA,SAASsD,oBAAoBA,CAAC2E,cAAwB,EAAE;AACtD,EAAA,IAAIxG,IAAI,CAAA;AAER,EAAA,IACEwG,cAAc,CAACC,QAAQ,CAAC,QAAQ,CAAC,IACjCD,cAAc,CAACC,QAAQ,CAAC,YAAY,CAAC,EACrC;AACAzG,IAAAA,IAAI,GAAG,QAAQ,CAAA;GAChB,MAAM,IAAIwG,cAAc,CAACC,QAAQ,CAAC,MAAM,CAAC,EAAE;AAC1CzG,IAAAA,IAAI,GAAG,MAAM,CAAA;GACd,MAAM,IAAIwG,cAAc,CAACC,QAAQ,CAAC,QAAQ,CAAC,EAAE;AAC5CzG,IAAAA,IAAI,GAAG,MAAM,CAAA;GACd,MAAM,IAAIwG,cAAc,CAACC,QAAQ,CAAC,QAAQ,CAAC,EAAE;AAC5CzG,IAAAA,IAAI,GAAG,QAAQ,CAAA;AACjB,GAAC,MAAM,IACLwG,cAAc,CAACC,QAAQ,CAAC,SAAS,CAAC,IAClCD,cAAc,CAACC,QAAQ,CAAC,OAAO,CAAC,EAChC;AACAzG,IAAAA,IAAI,GAAG,SAAS,CAAA;GACjB,MAAM,IAAIwG,cAAc,CAACC,QAAQ,CAAC,MAAM,CAAC,EAAE;AAC1CzG,IAAAA,IAAI,GAAG,MAAM,CAAA;AACf,GAAC,MAAM,IACLwG,cAAc,CAACC,QAAQ,CAAC,OAAO,CAAC,IAChCD,cAAc,CAACC,QAAQ,CAAC,QAAQ,CAAC,EACjC;AACAzG,IAAAA,IAAI,GAAG,OAAO,CAAA;GACf,MAAM,IAAIwG,cAAc,CAACC,QAAQ,CAAC,oBAAoB,CAAC,EAAE;AACxDzG,IAAAA,IAAI,GAAG,oBAAoB,CAAA;AAC7B,GAAC,MAAM;AACLA,IAAAA,IAAI,GAAG,MAAM,CAAA;AACf,GAAA;AAEA,EAAA,OAAOA,IAAI,CAAA;AACb;;;;"}