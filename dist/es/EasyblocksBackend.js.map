{"version":3,"file":"EasyblocksBackend.js","sources":["../../src/EasyblocksBackend.ts"],"sourcesContent":["import {\n  Backend,\n  NoCodeComponentEntry,\n  UserDefinedTemplate,\n  Document,\n} from \"./types\";\n\ntype RequestSearchParams = Record<string, string | Array<string>>;\n\ntype ApiRequestOptions = {\n  method: \"GET\" | \"POST\" | \"PUT\" | \"DELETE\" | \"PATCH\";\n  body?: any;\n  headers?: Record<string, string>;\n  searchParams?: RequestSearchParams;\n};\n\ntype ApiGetRequestOptions = Omit<ApiRequestOptions, \"method\" | \"body\">;\n\ntype ApiPostRequestOptions = Omit<ApiRequestOptions, \"method\">;\n\ntype ApiPutRequestOptions = Omit<ApiRequestOptions, \"method\">;\n\ntype ApiDeleteRequestOptions = Omit<ApiRequestOptions, \"method\" | \"body\">;\n\ntype DateString = string;\n\nexport type DocumentDTO = {\n  archived: boolean;\n  config_id: string;\n  created_at: DateString;\n  id: string;\n  project_id: string;\n  source: string;\n  title: string;\n  unique_source_identifier: string | null;\n  updated_at: DateString;\n  version: number;\n  root_container: string | null;\n};\n\nexport type DocumentWithResolvedConfigDTO = DocumentDTO & {\n  config: ConfigDTO;\n};\n\nexport type ConfigDTO = {\n  config: NoCodeComponentEntry;\n  created_at: DateString;\n  id: string;\n  metadata: Record<string, unknown> | null;\n  parent_id: string | null;\n  project_id: string;\n  updated_at: DateString;\n};\n\ntype Project = {\n  id: string;\n  name: string;\n  tokens: Array<string>;\n};\n\nexport type AssetDTO = {\n  id: string;\n  name: string;\n  url: string;\n} & (\n  | {\n      mediaType: \"image\";\n      metadata: { width: number; height: number; mimeType: string };\n    }\n  | {\n      mediaType: \"video\";\n      metadata: { mimeType: string };\n    }\n);\n\nconst AUTH_HEADER = \"x-shopstory-access-token\";\n\nexport class EasyblocksBackend implements Backend {\n  private project?: {\n    id: string;\n    tokens: string[];\n    name: string;\n  };\n\n  private accessToken: string;\n  private rootUrl: string;\n\n  constructor(args: { accessToken: string; rootUrl?: string }) {\n    this.accessToken = args.accessToken;\n    this.rootUrl = args.rootUrl ?? \"https://app.easyblocks.io\";\n  }\n\n  private async init() {\n    // don't reinitialize\n    if (this.project) {\n      return;\n    }\n\n    // Set project!\n    const response = await this.get(\"/projects\");\n\n    if (response.ok) {\n      const projects = (await response.json()) as Array<Project>;\n\n      if (projects.length === 0) {\n        throw new Error(\n          \"Authorization error. Have you provided a correct access token?\"\n        );\n      }\n\n      this.project = projects[0];\n    } else {\n      throw new Error(\"Initialization error in ApiClient\");\n    }\n  }\n\n  private async request(path: string, options: ApiRequestOptions) {\n    const apiRequestUrl = new URL(`${this.rootUrl}/api${path}`);\n\n    if (options.searchParams && Object.keys(options.searchParams).length > 0) {\n      for (const [key, value] of Object.entries(options.searchParams)) {\n        if (Array.isArray(value)) {\n          value.forEach((value) => {\n            apiRequestUrl.searchParams.append(key, value);\n          });\n        } else {\n          apiRequestUrl.searchParams.set(key, value);\n        }\n      }\n    }\n\n    const headers: HeadersInit = {\n      ...(path.includes(\"assets\")\n        ? {}\n        : { \"Content-Type\": \"application/json\" }),\n      ...options.headers,\n      [AUTH_HEADER]: this.accessToken,\n    };\n\n    const body = options.body\n      ? typeof options.body === \"object\" && !(options.body instanceof FormData)\n        ? JSON.stringify(options.body)\n        : options.body\n      : undefined;\n\n    return fetch(apiRequestUrl.toString(), {\n      method: options.method,\n      headers,\n      body,\n    });\n  }\n\n  private async get(path: string, options: ApiGetRequestOptions = {}) {\n    return this.request(path, { ...options, method: \"GET\" });\n  }\n\n  private async post(path: string, options: ApiPostRequestOptions = {}) {\n    return this.request(path, { ...options, method: \"POST\" });\n  }\n\n  private async put(path: string, options: ApiPutRequestOptions = {}) {\n    return this.request(path, { ...options, method: \"PUT\" });\n  }\n\n  private async delete(path: string, options: ApiDeleteRequestOptions = {}) {\n    return this.request(path, { ...options, method: \"DELETE\" });\n  }\n\n  documents = {\n    get: async (payload: { id: string }): Promise<Document> => {\n      await this.init();\n\n      const response = await this.get(\n        `/projects/${this.project!.id}/documents/${payload.id}`,\n        {\n          searchParams: {\n            format: \"full\",\n          },\n        }\n      );\n\n      if (response.ok) {\n        return documentWithResolvedConfigDTOToDocument(\n          (await response.json()) as DocumentWithResolvedConfigDTO\n        );\n      }\n\n      throw new Error(\"Failed to get document\");\n    },\n\n    create: async (\n      payload: Omit<Document, \"id\" | \"version\">\n    ): Promise<Document> => {\n      await this.init();\n\n      const response = await this.post(\n        `/projects/${this.project!.id}/documents`,\n        {\n          body: {\n            title: \"Untitled\",\n            config: payload.entry,\n            rootContainer: payload.entry._component,\n          },\n        }\n      );\n\n      if (response.ok) {\n        return documentDTOToDocument(\n          (await response.json()) as DocumentDTO,\n          payload.entry\n        );\n      }\n\n      if (response.status === 400) {\n        const errorData = await response.json();\n        throw new Error(errorData.error);\n      }\n\n      throw new Error(\"Failed to save document\");\n    },\n\n    update: async (payload: Document): Promise<Document> => {\n      await this.init();\n\n      const response = await this.put(\n        `/projects/${this.project!.id}/documents/${payload.id}`,\n        {\n          body: {\n            version: payload.version,\n            config: payload.entry,\n          },\n        }\n      );\n\n      if (response.ok) {\n        return documentDTOToDocument(\n          (await response.json()) as DocumentDTO,\n          payload.entry\n        );\n      }\n\n      if (response.status === 400) {\n        const errorData = await response.json();\n        throw new Error(errorData.error);\n      }\n\n      throw new Error(\"Failed to update document\");\n    },\n  };\n\n  templates = {\n    get: async (payload: { id: string }): Promise<UserDefinedTemplate> => {\n      await this.init();\n\n      // dummy inefficient implementation\n      const allTemplates = await this.templates.getAll();\n      const template = allTemplates.find(\n        (template) => template.id === payload.id\n      );\n\n      if (!template) {\n        throw new Error(\"Template not found\");\n      }\n\n      return template;\n    },\n    getAll: async (): Promise<UserDefinedTemplate[]> => {\n      await this.init();\n\n      try {\n        const response = await this.get(\n          `/projects/${this.project!.id}/templates`\n        );\n        const data: Array<any> = await response.json();\n\n        const templates = data.map<UserDefinedTemplate>((item) => ({\n          id: item.id,\n          label: item.label,\n          entry: item.config.config,\n          isUserDefined: true,\n          width: item.width,\n          widthAuto: item.widthAuto,\n        }));\n\n        return templates;\n      } catch (error) {\n        console.error(error);\n        return [];\n      }\n    },\n    create: async (input: {\n      label: string;\n      entry: NoCodeComponentEntry;\n      width?: number;\n      widthAuto?: boolean;\n    }): Promise<UserDefinedTemplate> => {\n      await this.init();\n\n      const payload = {\n        label: input.label,\n        config: input.entry,\n        masterTemplateIds: [],\n        width: input.width,\n        widthAuto: input.widthAuto,\n      };\n\n      const response = await this.request(\n        `/projects/${this.project!.id}/templates`,\n        {\n          method: \"POST\",\n          body: JSON.stringify(payload),\n        }\n      );\n\n      if (response.status !== 200) {\n        throw new Error(\"couldn't create template\");\n      }\n\n      const json = await response.json();\n\n      return {\n        id: json.id,\n        label: json.label,\n        entry: input.entry,\n        isUserDefined: true,\n      };\n    },\n    update: async (input: {\n      id: string;\n      label: string;\n    }): Promise<Omit<UserDefinedTemplate, \"entry\">> => {\n      await this.init();\n\n      const payload = {\n        label: input.label,\n        masterTemplateIds: [],\n      };\n\n      const response = await this.request(\n        `/projects/${this.project!.id}/templates/${input.id}`,\n        {\n          method: \"PUT\",\n          body: JSON.stringify(payload),\n        }\n      );\n\n      const json = await response.json();\n\n      console.log(\"update template json\", json);\n\n      if (response.status !== 200) {\n        throw new Error();\n      }\n\n      return {\n        id: json.id,\n        label: json.label,\n        isUserDefined: true,\n      };\n    },\n    delete: async (input: { id: string }) => {\n      await this.init();\n\n      const response = await this.request(\n        `/projects/${this.project!.id}/templates/${input.id}`,\n        {\n          method: \"DELETE\",\n        }\n      );\n\n      if (response.status !== 200) {\n        throw new Error();\n      }\n    },\n  };\n}\n\nfunction documentDTOToDocument(\n  documentDTO: DocumentDTO,\n  entry: NoCodeComponentEntry\n): Document {\n  if (!documentDTO.root_container) {\n    throw new Error(\"unexpected server error\");\n  }\n\n  return {\n    id: documentDTO.id,\n    version: documentDTO.version,\n\n    entry,\n  };\n}\n\nfunction documentWithResolvedConfigDTOToDocument(\n  documentWithResolvedConfigDTO: DocumentWithResolvedConfigDTO\n): Document {\n  return documentDTOToDocument(\n    documentWithResolvedConfigDTO,\n    documentWithResolvedConfigDTO.config.config\n  );\n}\n"],"names":["AUTH_HEADER","EasyblocksBackend","constructor","args","accessToken","rootUrl","init","project","response","get","ok","projects","json","length","Error","request","path","options","apiRequestUrl","URL","searchParams","Object","keys","key","value","entries","Array","isArray","forEach","append","set","headers","includes","body","FormData","JSON","stringify","undefined","fetch","toString","method","arguments","post","put","delete","documents","payload","id","format","documentWithResolvedConfigDTOToDocument","create","title","config","entry","rootContainer","_component","documentDTOToDocument","status","errorData","error","update","version","templates","allTemplates","getAll","template","find","data","map","item","label","isUserDefined","width","widthAuto","console","input","masterTemplateIds","log","documentDTO","root_container","documentWithResolvedConfigDTO"],"mappings":"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"}