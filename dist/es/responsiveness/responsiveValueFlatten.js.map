{"version":3,"file":"responsiveValueFlatten.js","sources":["../../../src/responsiveness/responsiveValueFlatten.ts"],"sourcesContent":["import { getDevicesWidths } from \"../compiler/devices\";\nimport { Devices, ResponsiveValue, TrulyResponsiveValue } from \"../types\";\nimport { isTrulyResponsiveValue } from \"./isTrulyResponsiveValue\";\nimport { responsiveValueGetDefinedValue } from \"./responsiveValueGetDefinedValue\";\nimport { responsiveValueGetHighestDefinedDevice } from \"./responsiveValueGetHighestDefinedDevice\";\n\n// Flattens recursively (max 2 levels)\nexport function responsiveValueFlatten<T>(\n  resVal: ResponsiveValue<ResponsiveValue<T>>,\n  devices: Devices\n): ResponsiveValue<T> {\n  if (!isTrulyResponsiveValue(resVal)) {\n    return resVal;\n  }\n\n  const result: ResponsiveValue<T> = {\n    $res: true,\n  };\n\n  let activeNestedValue: TrulyResponsiveValue<T> | undefined = undefined;\n\n  // resValCopy has maximum breakpoint always set correctly, otherwise if we have b1, ..., b5 and responsive value is set to b4, then values ABOVE b4 won't be set.\n  const resValCopy = { ...resVal };\n  const maxDeviceInValue = responsiveValueGetHighestDefinedDevice(\n    resValCopy,\n    devices\n  );\n  const maxBreakpoint = devices[devices.length - 1].id;\n\n  // Important condition. Sometimes if b5 is missing, b3 can be responsive and have b5 inside. Then b5 is defined.\n  if (\n    !resValCopy[maxBreakpoint] &&\n    isTrulyResponsiveValue(resValCopy[maxDeviceInValue.id])\n  ) {\n    activeNestedValue = resValCopy[\n      maxDeviceInValue.id\n    ] as TrulyResponsiveValue<T>;\n  }\n\n  for (let i = devices.length - 1; i >= 0; i--) {\n    const breakpoint = devices[i].id;\n    const value = resValCopy[breakpoint];\n\n    if (value === undefined) {\n      // If active nested value, we take from nested value;\n      if (\n        activeNestedValue !== undefined &&\n        activeNestedValue[breakpoint] !== undefined\n      ) {\n        result[breakpoint] = responsiveValueGetDefinedValue(\n          activeNestedValue,\n          breakpoint,\n          devices,\n          getDevicesWidths(\n            devices\n          ) /** FOR NOW TOKENS ARE ALWAYS RELATIVE TO SCREEN WIDTH */\n        )!;\n      }\n      continue;\n    } else if (!isTrulyResponsiveValue(value as ResponsiveValue<T>)) {\n      activeNestedValue = undefined;\n      result[breakpoint] = value as T;\n    } else {\n      activeNestedValue = value as TrulyResponsiveValue<T>;\n      result[breakpoint] = responsiveValueGetDefinedValue(\n        activeNestedValue,\n        breakpoint,\n        devices,\n        getDevicesWidths(\n          devices\n        ) /** FOR NOW TOKENS ARE ALWAYS RELATIVE TO SCREEN WIDTH */\n      )!;\n    }\n  }\n\n  return result;\n}\n"],"names":["responsiveValueFlatten","resVal","devices","isTrulyResponsiveValue","result","$res","activeNestedValue","undefined","resValCopy","maxDeviceInValue","responsiveValueGetHighestDefinedDevice","maxBreakpoint","length","id","i","breakpoint","value","responsiveValueGetDefinedValue","getDevicesWidths"],"mappings":";;;;;;AAMA;AACO,SAASA,sBAAsBA,CACpCC,MAA2C,EAC3CC,OAAgB,EACI;AACpB,EAAA,IAAI,CAACC,sBAAsB,CAACF,MAAM,CAAC,EAAE;AACnC,IAAA,OAAOA,MAAM,CAAA;AACf,GAAA;AAEA,EAAA,MAAMG,MAA0B,GAAG;AACjCC,IAAAA,IAAI,EAAE,IAAA;GACP,CAAA;EAED,IAAIC,iBAAsD,GAAGC,SAAS,CAAA;;AAEtE;AACA,EAAA,MAAMC,UAAU,GAAG;IAAE,GAAGP,MAAAA;GAAQ,CAAA;AAChC,EAAA,MAAMQ,gBAAgB,GAAGC,sCAAsC,CAC7DF,UAAU,EACVN,OACF,CAAC,CAAA;EACD,MAAMS,aAAa,GAAGT,OAAO,CAACA,OAAO,CAACU,MAAM,GAAG,CAAC,CAAC,CAACC,EAAE,CAAA;;AAEpD;AACA,EAAA,IACE,CAACL,UAAU,CAACG,aAAa,CAAC,IAC1BR,sBAAsB,CAACK,UAAU,CAACC,gBAAgB,CAACI,EAAE,CAAC,CAAC,EACvD;AACAP,IAAAA,iBAAiB,GAAGE,UAAU,CAC5BC,gBAAgB,CAACI,EAAE,CACO,CAAA;AAC9B,GAAA;AAEA,EAAA,KAAK,IAAIC,CAAC,GAAGZ,OAAO,CAACU,MAAM,GAAG,CAAC,EAAEE,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAAE;AAC5C,IAAA,MAAMC,UAAU,GAAGb,OAAO,CAACY,CAAC,CAAC,CAACD,EAAE,CAAA;AAChC,IAAA,MAAMG,KAAK,GAAGR,UAAU,CAACO,UAAU,CAAC,CAAA;IAEpC,IAAIC,KAAK,KAAKT,SAAS,EAAE;AACvB;MACA,IACED,iBAAiB,KAAKC,SAAS,IAC/BD,iBAAiB,CAACS,UAAU,CAAC,KAAKR,SAAS,EAC3C;AACAH,QAAAA,MAAM,CAACW,UAAU,CAAC,GAAGE,8BAA8B,CACjDX,iBAAiB,EACjBS,UAAU,EACVb,OAAO,EACPgB,gBAAgB,CACdhB,OACF,CAAC,2DACD,CAAA;AACJ,OAAA;AACA,MAAA,SAAA;AACF,KAAC,MAAM,IAAI,CAACC,sBAAsB,CAACa,KAA2B,CAAC,EAAE;AAC/DV,MAAAA,iBAAiB,GAAGC,SAAS,CAAA;AAC7BH,MAAAA,MAAM,CAACW,UAAU,CAAC,GAAGC,KAAU,CAAA;AACjC,KAAC,MAAM;AACLV,MAAAA,iBAAiB,GAAGU,KAAgC,CAAA;AACpDZ,MAAAA,MAAM,CAACW,UAAU,CAAC,GAAGE,8BAA8B,CACjDX,iBAAiB,EACjBS,UAAU,EACVb,OAAO,EACPgB,gBAAgB,CACdhB,OACF,CAAC,2DACD,CAAA;AACJ,KAAA;AACF,GAAA;AAEA,EAAA,OAAOE,MAAM,CAAA;AACf;;;;"}