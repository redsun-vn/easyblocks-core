{"version":3,"file":"responsiveValueFlatten.js","sources":["../../../src/responsiveness/responsiveValueFlatten.ts"],"sourcesContent":["import { getDevicesWidths } from \"../compiler/devices\";\r\nimport { Devices, ResponsiveValue, TrulyResponsiveValue } from \"../types\";\r\nimport { isTrulyResponsiveValue } from \"./isTrulyResponsiveValue\";\r\nimport { responsiveValueGetDefinedValue } from \"./responsiveValueGetDefinedValue\";\r\nimport { responsiveValueGetHighestDefinedDevice } from \"./responsiveValueGetHighestDefinedDevice\";\r\n\r\n// Flattens recursively (max 2 levels)\r\nexport function responsiveValueFlatten<T>(\r\n  resVal: ResponsiveValue<ResponsiveValue<T>>,\r\n  devices: Devices\r\n): ResponsiveValue<T> {\r\n  if (!isTrulyResponsiveValue(resVal)) {\r\n    return resVal;\r\n  }\r\n\r\n  const result: ResponsiveValue<T> = {\r\n    $res: true,\r\n  };\r\n\r\n  let activeNestedValue: TrulyResponsiveValue<T> | undefined = undefined;\r\n\r\n  // resValCopy has maximum breakpoint always set correctly, otherwise if we have b1, ..., b5 and responsive value is set to b4, then values ABOVE b4 won't be set.\r\n  const resValCopy = { ...resVal };\r\n  const maxDeviceInValue = responsiveValueGetHighestDefinedDevice(\r\n    resValCopy,\r\n    devices\r\n  );\r\n  const maxBreakpoint = devices[devices.length - 1].id;\r\n\r\n  // Important condition. Sometimes if b5 is missing, b3 can be responsive and have b5 inside. Then b5 is defined.\r\n  if (\r\n    !resValCopy[maxBreakpoint] &&\r\n    isTrulyResponsiveValue(resValCopy[maxDeviceInValue.id])\r\n  ) {\r\n    activeNestedValue = resValCopy[\r\n      maxDeviceInValue.id\r\n    ] as TrulyResponsiveValue<T>;\r\n  }\r\n\r\n  for (let i = devices.length - 1; i >= 0; i--) {\r\n    const breakpoint = devices[i].id;\r\n    const value = resValCopy[breakpoint];\r\n\r\n    if (value === undefined) {\r\n      // If active nested value, we take from nested value;\r\n      if (\r\n        activeNestedValue !== undefined &&\r\n        activeNestedValue[breakpoint] !== undefined\r\n      ) {\r\n        result[breakpoint] = responsiveValueGetDefinedValue(\r\n          activeNestedValue,\r\n          breakpoint,\r\n          devices,\r\n          getDevicesWidths(\r\n            devices\r\n          ) /** FOR NOW TOKENS ARE ALWAYS RELATIVE TO SCREEN WIDTH */\r\n        )!;\r\n      }\r\n      continue;\r\n    } else if (!isTrulyResponsiveValue(value as ResponsiveValue<T>)) {\r\n      activeNestedValue = undefined;\r\n      result[breakpoint] = value as T;\r\n    } else {\r\n      activeNestedValue = value as TrulyResponsiveValue<T>;\r\n      result[breakpoint] = responsiveValueGetDefinedValue(\r\n        activeNestedValue,\r\n        breakpoint,\r\n        devices,\r\n        getDevicesWidths(\r\n          devices\r\n        ) /** FOR NOW TOKENS ARE ALWAYS RELATIVE TO SCREEN WIDTH */\r\n      )!;\r\n    }\r\n  }\r\n\r\n  return result;\r\n}\r\n"],"names":["responsiveValueFlatten","resVal","devices","isTrulyResponsiveValue","result","$res","activeNestedValue","undefined","resValCopy","maxDeviceInValue","responsiveValueGetHighestDefinedDevice","maxBreakpoint","length","id","i","breakpoint","value","responsiveValueGetDefinedValue","getDevicesWidths"],"mappings":";;;;;;AAMA;AACO,SAASA,sBAAsBA,CACpCC,MAA2C,EAC3CC,OAAgB,EACI;AACpB,EAAA,IAAI,CAACC,sBAAsB,CAACF,MAAM,CAAC,EAAE;AACnC,IAAA,OAAOA,MAAM,CAAA;AACf,GAAA;AAEA,EAAA,MAAMG,MAA0B,GAAG;AACjCC,IAAAA,IAAI,EAAE,IAAA;GACP,CAAA;EAED,IAAIC,iBAAsD,GAAGC,SAAS,CAAA;;AAEtE;AACA,EAAA,MAAMC,UAAU,GAAG;IAAE,GAAGP,MAAAA;GAAQ,CAAA;AAChC,EAAA,MAAMQ,gBAAgB,GAAGC,sCAAsC,CAC7DF,UAAU,EACVN,OACF,CAAC,CAAA;EACD,MAAMS,aAAa,GAAGT,OAAO,CAACA,OAAO,CAACU,MAAM,GAAG,CAAC,CAAC,CAACC,EAAE,CAAA;;AAEpD;AACA,EAAA,IACE,CAACL,UAAU,CAACG,aAAa,CAAC,IAC1BR,sBAAsB,CAACK,UAAU,CAACC,gBAAgB,CAACI,EAAE,CAAC,CAAC,EACvD;AACAP,IAAAA,iBAAiB,GAAGE,UAAU,CAC5BC,gBAAgB,CAACI,EAAE,CACO,CAAA;AAC9B,GAAA;AAEA,EAAA,KAAK,IAAIC,CAAC,GAAGZ,OAAO,CAACU,MAAM,GAAG,CAAC,EAAEE,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAAE;AAC5C,IAAA,MAAMC,UAAU,GAAGb,OAAO,CAACY,CAAC,CAAC,CAACD,EAAE,CAAA;AAChC,IAAA,MAAMG,KAAK,GAAGR,UAAU,CAACO,UAAU,CAAC,CAAA;IAEpC,IAAIC,KAAK,KAAKT,SAAS,EAAE;AACvB;MACA,IACED,iBAAiB,KAAKC,SAAS,IAC/BD,iBAAiB,CAACS,UAAU,CAAC,KAAKR,SAAS,EAC3C;AACAH,QAAAA,MAAM,CAACW,UAAU,CAAC,GAAGE,8BAA8B,CACjDX,iBAAiB,EACjBS,UAAU,EACVb,OAAO,EACPgB,gBAAgB,CACdhB,OACF,CAAC,2DACD,CAAA;AACJ,OAAA;AACA,MAAA,SAAA;AACF,KAAC,MAAM,IAAI,CAACC,sBAAsB,CAACa,KAA2B,CAAC,EAAE;AAC/DV,MAAAA,iBAAiB,GAAGC,SAAS,CAAA;AAC7BH,MAAAA,MAAM,CAACW,UAAU,CAAC,GAAGC,KAAU,CAAA;AACjC,KAAC,MAAM;AACLV,MAAAA,iBAAiB,GAAGU,KAAgC,CAAA;AACpDZ,MAAAA,MAAM,CAACW,UAAU,CAAC,GAAGE,8BAA8B,CACjDX,iBAAiB,EACjBS,UAAU,EACVb,OAAO,EACPgB,gBAAgB,CACdhB,OACF,CAAC,2DACD,CAAA;AACJ,KAAA;AACF,GAAA;AAEA,EAAA,OAAOE,MAAM,CAAA;AACf;;;;"}