{"version":3,"file":"buildDocument.js","sources":["../../src/buildDocument.ts"],"sourcesContent":["import { buildEntry } from \"./buildEntry\";\nimport type {\n  RequestedExternalData,\n  Document,\n  Config,\n  RenderableDocument,\n} from \"./types\";\nimport { serialize } from \"@/utils\";\n\nasync function buildDocument({\n  documentId,\n  config,\n  locale,\n}: {\n  documentId: string;\n  config: Config;\n  locale: string;\n}): Promise<{\n  renderableDocument: RenderableDocument;\n  externalData: RequestedExternalData;\n}> {\n  const { entry } = await resolveEntryForDocument({\n    documentId,\n    config,\n    locale,\n  });\n\n  const { meta, externalData, renderableContent, configAfterAuto } = buildEntry(\n    {\n      entry,\n      config,\n      locale,\n    }\n  );\n\n  return {\n    renderableDocument: {\n      renderableContent,\n      meta: serialize(meta),\n      configAfterAuto,\n    },\n    externalData,\n  };\n}\n\nexport { buildDocument };\n\nasync function resolveEntryForDocument({\n  documentId,\n  config,\n  locale,\n}: {\n  documentId: string;\n  config: Config;\n  locale: string;\n}): Promise<Document> {\n  try {\n    const documentResponse = await config.backend.documents.get({\n      id: documentId,\n      locale,\n    });\n\n    if (!documentResponse) {\n      throw new Error(`Document with id ${documentId} not found.`);\n    }\n\n    return documentResponse;\n  } catch {\n    throw new Error(`Error fetching document with id ${documentId}.`);\n  }\n}\n"],"names":["buildDocument","_ref","documentId","config","locale","entry","resolveEntryForDocument","meta","externalData","renderableContent","configAfterAuto","buildEntry","renderableDocument","serialize","_ref2","documentResponse","backend","documents","get","id","Error"],"mappings":";;;;AASA,eAAeA,aAAaA,CAAAC,IAAA,EAWzB;EAAA,IAX0B;IAC3BC,UAAU;IACVC,MAAM;AACNC,IAAAA,MAAAA;AAKF,GAAC,GAAAH,IAAA,CAAA;EAIC,MAAM;AAAEI,IAAAA,KAAAA;GAAO,GAAG,MAAMC,uBAAuB,CAAC;IAC9CJ,UAAU;IACVC,MAAM;AACNC,IAAAA,MAAAA;AACF,GAAC,CAAC,CAAA;EAEF,MAAM;IAAEG,IAAI;IAAEC,YAAY;IAAEC,iBAAiB;AAAEC,IAAAA,eAAAA;GAAiB,GAAGC,UAAU,CAC3E;IACEN,KAAK;IACLF,MAAM;AACNC,IAAAA,MAAAA;AACF,GACF,CAAC,CAAA;EAED,OAAO;AACLQ,IAAAA,kBAAkB,EAAE;MAClBH,iBAAiB;AACjBF,MAAAA,IAAI,EAAEM,SAAS,CAACN,IAAI,CAAC;AACrBG,MAAAA,eAAAA;KACD;AACDF,IAAAA,YAAAA;GACD,CAAA;AACH,CAAA;AAIA,eAAeF,uBAAuBA,CAAAQ,KAAA,EAQhB;EAAA,IARiB;IACrCZ,UAAU;IACVC,MAAM;AACNC,IAAAA,MAAAA;AAKF,GAAC,GAAAU,KAAA,CAAA;EACC,IAAI;IACF,MAAMC,gBAAgB,GAAG,MAAMZ,MAAM,CAACa,OAAO,CAACC,SAAS,CAACC,GAAG,CAAC;AAC1DC,MAAAA,EAAE,EAAEjB,UAAU;AACdE,MAAAA,MAAAA;AACF,KAAC,CAAC,CAAA;IAEF,IAAI,CAACW,gBAAgB,EAAE;AACrB,MAAA,MAAM,IAAIK,KAAK,CAAC,CAAoBlB,iBAAAA,EAAAA,UAAU,aAAa,CAAC,CAAA;AAC9D,KAAA;AAEA,IAAA,OAAOa,gBAAgB,CAAA;AACzB,GAAC,CAAC,MAAM;AACN,IAAA,MAAM,IAAIK,KAAK,CAAC,CAAmClB,gCAAAA,EAAAA,UAAU,GAAG,CAAC,CAAA;AACnE,GAAA;AACF;;;;"}