{"version":3,"file":"compileComponent.js","sources":["../../../src/compiler/compileComponent.ts"],"sourcesContent":["import {\n  assertDefined,\n  bubbleDown,\n  deepClone,\n  deepCompare,\n  dotNotationGet,\n  dotNotationSet,\n  entries,\n  raiseError,\n  toArray,\n  uniqueId,\n} from \"@/utils\";\nimport { xxHash32 } from \"js-xxhash\";\nimport { isComponentConfig } from \"../checkers\";\nimport {\n  responsiveValueAt,\n  responsiveValueFill,\n  responsiveValueNormalize,\n} from \"../responsiveness\";\nimport {\n  AnyEditingField,\n  ChildComponentEditingInfo,\n  CompilationMetadata,\n  CompiledCustomComponentConfig,\n  CompiledShopstoryComponentConfig,\n  ComponentCollectionLocalisedSchemaProp,\n  ComponentCollectionSchemaProp,\n  ComponentSchemaProp,\n  NoCodeComponentEntry,\n  EditingField,\n  EditingInfo,\n  FieldPortal,\n  NoCodeComponentEditingFunctionResult,\n  NoCodeComponentStylesFunctionInput,\n  ScalarOrCollection,\n  SchemaProp,\n  SerializedComponentDefinitions,\n  SerializedRenderableComponentDefinition,\n  SpaceSchemaProp,\n  TrulyResponsiveValue,\n  CompiledComponentConfig,\n} from \"../types\";\nimport type {\n  CompilationCache,\n  CompilationCacheItemValue,\n} from \"./CompilationCache\";\nimport { applyAutoUsingResponsiveTokens } from \"./applyAutoUsingResponsiveTokens\";\nimport { compileBox } from \"./box\";\nimport { RichTextComponentConfig } from \"./builtins/$richText/$richText\";\nimport { compileComponentValues } from \"./compileComponentValues\";\nimport { compileFromSchema } from \"./compileFromSchema\";\nimport { ConfigComponentCompilationOutput } from \"./definitions\";\nimport { getDevicesWidths } from \"./devices\";\nimport {\n  findComponentDefinition,\n  findComponentDefinitionById,\n} from \"./findComponentDefinition\";\nimport { getMostCommonValueFromRichTextParts } from \"./getMostCommonValueFromRichTextParts\";\nimport { linearizeSpace } from \"./linearizeSpace\";\nimport { parsePath } from \"./parsePath\";\nimport { resop2, scalarizeConfig } from \"./resop\";\nimport {\n  Component$$$SchemaProp,\n  isExternalSchemaProp,\n  isSchemaPropActionTextModifier,\n  isSchemaPropCollection,\n  isSchemaPropComponent,\n  isSchemaPropComponentCollectionLocalised,\n  isSchemaPropComponentOrComponentCollection,\n  isSchemaPropTextModifier,\n} from \"./schema\";\nimport { getTinaField } from \"./tinaFieldProviders\";\nimport {\n  CompilationContextType,\n  ContextProps,\n  EditingInfoComponent,\n  EditingInfoComponentCollection,\n  EditorContextType,\n  InternalComponentDefinition,\n  InternalEditingField,\n  InternalEditingFunctionResult,\n  InternalEditingInfo,\n  InternalRenderableComponentDefinition,\n} from \"./types\";\nimport { getFallbackLocaleForLocale } from \"../locales\";\n\ntype ComponentCompilationArtifacts = {\n  compiledComponentConfig: CompiledComponentConfig;\n  configAfterAuto: NoCodeComponentEntry;\n};\n\nexport function compileComponent(\n  editableElement: NoCodeComponentEntry,\n  compilationContext: CompilationContextType,\n  contextProps: ContextProps, // contextProps are already compiled! They're result of compilation function.\n  meta: any,\n  cache: CompilationCache,\n  parentComponentEditingInfo?:\n    | EditingInfoComponent\n    | EditingInfoComponentCollection,\n  configPrefix = \"\"\n): ComponentCompilationArtifacts {\n  if (!isComponentConfig(editableElement)) {\n    console.error(\n      \"[compile] wrong input for compileComponent\",\n      editableElement\n    );\n\n    throw new Error(\"[compile] wrong input for compileComponent\");\n  }\n\n  if (contextProps.$width === undefined || contextProps.$width === -1) {\n    throw new Error(\n      `assertion failed: incorrect $width in compileComponent: ${contextProps.$width}, component: ${editableElement._id}, ${editableElement._component}`\n    );\n  }\n\n  const cachedResult = cache.get(editableElement._id);\n\n  let componentDefinition = findComponentDefinitionById(\n    editableElement._component,\n    compilationContext\n  );\n\n  if (!componentDefinition) {\n    componentDefinition = assertDefined(\n      findComponentDefinitionById(\n        \"@easyblocks/missing-component\",\n        compilationContext\n      )\n    );\n\n    const error = `Easyblocks canâ€™t find definition for component \"${editableElement._component}\" in your config. Please contact your developers to resolve this issue.`;\n\n    editableElement = {\n      _component: componentDefinition.id,\n      _id: uniqueId(),\n      error,\n    };\n\n    console.warn(error);\n\n    parentComponentEditingInfo = undefined;\n  }\n\n  const ownProps = createOwnComponentProps({\n    config: editableElement,\n    contextProps,\n    componentDefinition,\n    compilationContext,\n  });\n\n  let hasComponentConfigChanged = true;\n\n  let ownPropsAfterAuto: {\n    values: { _id: string; _component: string } & Record<string, any>;\n    params: Record<string, any>;\n  };\n  let compiled: CompiledComponentConfig = {\n    _component: editableElement._component,\n    _id: editableElement._id,\n    props: {},\n    components: {},\n    styled: {},\n  };\n  let configAfterAuto: any;\n  let editingInfo: InternalEditingInfo | undefined;\n  let compiledValues: Record<string, any> = {};\n  let subcomponentsContextProps: CompilationCacheItemValue[\"contextProps\"] = {};\n  let editingContextProps: CompilationCacheItemValue[\"editingContextProps\"];\n\n  if (cachedResult) {\n    hasComponentConfigChanged = !deepCompare(ownProps, cachedResult.values);\n\n    if (!hasComponentConfigChanged) {\n      ownPropsAfterAuto = cachedResult.valuesAfterAuto;\n      compiledValues = cachedResult.compiledValues;\n      compiled = cachedResult.compiledConfig;\n      configAfterAuto = deepClone({\n        ...cachedResult.valuesAfterAuto.values,\n        ...cachedResult.valuesAfterAuto.params,\n      });\n      subcomponentsContextProps = cachedResult.contextProps;\n      editingContextProps = cachedResult.editingContextProps;\n    }\n  }\n\n  addComponentToSerializedComponentDefinitions(\n    editableElement,\n    meta,\n    \"components\",\n    compilationContext\n  );\n\n  const { $width, $widthAuto } = calculateWidths(\n    compilationContext,\n    contextProps\n  );\n\n  if (hasComponentConfigChanged) {\n    // We are going to mutate this object so let's disconnect it from its source object\n    ownPropsAfterAuto = deepClone(ownProps);\n\n    /**\n     * APPLY AUTO\n     */\n\n    const DEFAULT_SPACE_AUTO_CONSTANT = 16;\n\n    // linearize space\n    componentDefinition.schema.forEach((schemaProp) => {\n      if (isSchemaPropTokenized(schemaProp)) {\n        ownPropsAfterAuto.values[schemaProp.prop] =\n          applyAutoUsingResponsiveTokens(\n            ownPropsAfterAuto.values[schemaProp.prop],\n            compilationContext\n          );\n      }\n\n      if (schemaProp.type === \"space\") {\n        ownPropsAfterAuto.values[schemaProp.prop] = linearizeSpace(\n          ownPropsAfterAuto.values[schemaProp.prop],\n          compilationContext,\n          $width,\n          (schemaProp as SpaceSchemaProp).params?.autoConstant ??\n          DEFAULT_SPACE_AUTO_CONSTANT\n        );\n      }\n    });\n\n    itemFieldsForEach(ownPropsAfterAuto.values, compilationContext, (arg) => {\n      let value = arg.itemPropValue;\n      if (isSchemaPropTokenized(arg.itemSchemaProp)) {\n        value = applyAutoUsingResponsiveTokens(value, compilationContext);\n      }\n\n      if (arg.itemSchemaProp.type === \"space\") {\n        value = linearizeSpace(\n          value,\n          compilationContext,\n          $width,\n          (arg.itemSchemaProp as SpaceSchemaProp).params?.autoConstant ??\n          DEFAULT_SPACE_AUTO_CONSTANT\n        );\n      }\n\n      dotNotationSet(ownPropsAfterAuto.values, arg.itemPropPath, value);\n    });\n\n    const autoFunction = (\n      componentDefinition as InternalRenderableComponentDefinition\n    ).auto;\n\n    if (autoFunction) {\n      const ownValuesAfterAuto = autoFunction({\n        values: ownPropsAfterAuto.values,\n        params: {\n          ...ownPropsAfterAuto.params,\n          $width,\n          $widthAuto,\n        },\n        devices: compilationContext.devices,\n      });\n\n      ownPropsAfterAuto.values = ownValuesAfterAuto;\n    }\n\n    // Fill all responsive values. We can assume that values after auto for each breakpoint MUST be defined!!!\n    // IMPORTANT: For now we make it realtive to device widths, so Webflow way\n    for (const prop in ownPropsAfterAuto.values) {\n      ownPropsAfterAuto.values[prop] = responsiveValueFill(\n        ownPropsAfterAuto.values[prop],\n        compilationContext.devices,\n        getDevicesWidths(compilationContext.devices)\n      );\n    }\n\n    for (const prop in ownPropsAfterAuto.params) {\n      ownPropsAfterAuto.params[prop] = responsiveValueFill(\n        ownPropsAfterAuto.params[prop],\n        compilationContext.devices,\n        getDevicesWidths(compilationContext.devices)\n      );\n    }\n\n    itemFieldsForEach(ownPropsAfterAuto.values, compilationContext, (arg) => {\n      dotNotationSet(\n        ownPropsAfterAuto.values,\n        arg.itemPropPath,\n        responsiveValueFill(\n          arg.itemPropValue,\n          compilationContext.devices,\n          getDevicesWidths(compilationContext.devices)\n        )\n      );\n    });\n\n    // First we compile all the props and store them in compiledValues\n    const _compiledValues = compileComponentValues(\n      ownPropsAfterAuto.values,\n      componentDefinition,\n      compilationContext,\n      cache\n    );\n\n    compiledValues = {\n      ...deepClone(ownPropsAfterAuto.values),\n      ..._compiledValues,\n    };\n\n    // Compile item props\n    itemFieldsForEach(\n      ownPropsAfterAuto.values,\n      compilationContext,\n      ({ itemPropValue, itemIndex, itemSchemaProp, collectionSchemaProp }) => {\n        const compiledValue: any = compileFromSchema(\n          itemPropValue,\n          itemSchemaProp,\n          compilationContext,\n          cache,\n          {},\n          meta\n        );\n\n        compiledValues[collectionSchemaProp.prop][itemIndex][\n          itemSchemaProp.prop\n        ] = compiledValue;\n      }\n    );\n\n    // We want to style block element based on the most common values from all text parts within all lines.\n    // Only for this component, we compile nested @easyblocks/rich-text-part components values.\n    if (editableElement._component === \"@easyblocks/rich-text\") {\n      if (compiledValues.isListStyleAuto) {\n        const {\n          mainColor = compiledValues.mainColor,\n          mainFont = compiledValues.mainFont,\n        } = compileRichTextValuesFromRichTextParts(\n          editableElement as RichTextComponentConfig,\n          compilationContext,\n          cache\n        );\n\n        compiledValues.mainColor = mainColor;\n        compiledValues.mainFont = mainFont;\n      }\n\n      compiledValues.mainFontSize = mapResponsiveFontToResponsiveFontSize(\n        compiledValues.mainFont\n      );\n    }\n\n    compiled = {\n      ...compiled,\n      components: {},\n      styled: {},\n    };\n\n    const renderableComponentDefinition =\n      componentDefinition as InternalRenderableComponentDefinition;\n\n    if (compilationContext.isEditing) {\n      /**\n       * Let's build default editingOutput (fields and component output)\n       */\n\n      const editorContext = compilationContext as EditorContextType;\n\n      editingInfo = buildDefaultEditingInfo(\n        renderableComponentDefinition,\n        configPrefix,\n        editorContext,\n        compiledValues,\n        editableElement._component\n      );\n\n      /**\n       * Let's run custom editing function\n       */\n      if (renderableComponentDefinition.editing) {\n        const scalarizedConfig = scalarizeConfig(\n          compiledValues,\n          editorContext.breakpointIndex,\n          editorContext.devices,\n          renderableComponentDefinition.schema\n        );\n\n        const identityEditingField = assertDefined(\n          editingInfo.fields.find((f) => f.prop === \"$myself\")\n        );\n\n        const editingInfoWithoutIdentityField: InternalEditingInfo = {\n          ...editingInfo,\n          // Filter out identity field, since it's not users responsibility to care of it.\n          fields: editingInfo.fields.filter((f) => f.prop !== \"$myself\"),\n        };\n\n        const editingInfoInput = convertInternalEditingInfoToEditingInfo(\n          editingInfoWithoutIdentityField,\n          configPrefix\n        );\n\n        const editingInfoResult = renderableComponentDefinition.editing({\n          values: scalarizedConfig,\n          params: ownPropsAfterAuto.params,\n          editingInfo: editingInfoInput,\n          device: editorContext.devices.find(\n            (device) => device.id === editorContext.breakpointIndex\n          )!,\n          ...(componentDefinition.id === \"@easyblocks/rich-text\" ||\n            componentDefinition.id === \"@easyblocks/rich-text-part\"\n            ? {\n              __SECRET_INTERNALS__: {\n                pathPrefix: configPrefix,\n                editorContext,\n              },\n            }\n            : {}),\n        });\n\n        if (editingInfoResult) {\n          const internalEditingInfo = convertEditingInfoToInternalEditingInfo(\n            editingInfoResult,\n            editingInfo,\n            componentDefinition,\n            editorContext,\n            configPrefix\n          );\n\n          internalEditingInfo.fields?.unshift(identityEditingField);\n          deepObjectMergeWithoutArrays(editingInfo, internalEditingInfo);\n        }\n      }\n\n      /**\n       * Save to __editing\n       */\n\n      applyEditingInfoToCompiledConfig(\n        compiled,\n        editingInfo,\n        parentComponentEditingInfo,\n        {\n          width: $width,\n          auto: $widthAuto,\n        }\n      );\n\n      editingContextProps = editingInfo.components;\n    }\n\n    const { props, components, styled } = resop2(\n      { values: compiledValues, params: ownPropsAfterAuto.params },\n      ({ values, params }, breakpointIndex) => {\n        if (!renderableComponentDefinition.styles) {\n          return {};\n        }\n\n        const device = assertDefined(\n          compilationContext.devices.find(\n            (device) => device.id === breakpointIndex\n          ),\n          `Missing device \"${breakpointIndex}\"`\n        );\n\n        const stylesInput: NoCodeComponentStylesFunctionInput = {\n          values,\n          params: {\n            ...params,\n            $width: assertDefined(responsiveValueAt($width, breakpointIndex)),\n            $widthAuto: assertDefined(\n              responsiveValueAt($widthAuto, breakpointIndex)\n            ),\n          },\n          isEditing: !!compilationContext.isEditing,\n          device,\n          ...(componentDefinition!.id === \"@easyblocks/rich-text-part\"\n            ? { __COMPILATION_CONTEXT__: compilationContext }\n            : {}),\n        };\n\n        return renderableComponentDefinition.styles(stylesInput);\n      },\n      compilationContext.devices,\n      renderableComponentDefinition\n    );\n\n    validateStylesProps(props, componentDefinition);\n\n    subcomponentsContextProps = components;\n\n    // Move all the boxes to _compiled\n    for (const key in styled) {\n      let styles: ScalarOrCollection<Record<string, any>> = styled[key];\n\n      if (Array.isArray(styles)) {\n        styles = styles.map((v) => {\n          return { ...v, __isBox: true };\n        });\n      } else {\n        styles = { ...styles, __isBox: true };\n      }\n\n      const schemaProp = componentDefinition.schema.find((x) => x.prop === key);\n\n      // Context props processed below\n      if (schemaProp) {\n        continue;\n      }\n\n      // If box\n\n      compiled.styled[key] = compileBoxes(styles, compilationContext);\n    }\n\n    componentDefinition.schema.forEach((schemaProp: SchemaProp) => {\n      if (\"buildOnly\" in schemaProp && schemaProp.buildOnly) {\n        return;\n      }\n\n      if (\n        isExternalSchemaProp(schemaProp, compilationContext.types) ||\n        schemaProp.type === \"text\"\n      ) {\n        // We simply copy ONLY the breakpoints which are defined in the raw data\n        compiled.props[schemaProp.prop] = Object.fromEntries(\n          Object.keys(editableElement[schemaProp.prop]).map((deviceId) => {\n            return [deviceId, compiledValues[schemaProp.prop][deviceId]];\n          })\n        );\n      } else {\n        compiled.props[schemaProp.prop] = responsiveValueNormalize(\n          compiledValues[schemaProp.prop],\n          compilationContext.devices\n        );\n      }\n    });\n\n    // we also add __props to props\n    compiled.props = {\n      ...props,\n      ...compiled.props,\n    };\n\n    // We are going to mutate this object so let's disconnect it from its source object\n    configAfterAuto = deepClone({\n      ...ownPropsAfterAuto.values,\n      ...ownPropsAfterAuto.params,\n    });\n  }\n\n  if (compilationContext.isEditing) {\n    /**\n     * Let's build default editingOutput (fields and component output)\n     */\n\n    const editorContext = compilationContext as EditorContextType;\n    const renderableComponentDefinition =\n      componentDefinition as InternalRenderableComponentDefinition;\n\n    editingInfo = buildDefaultEditingInfo(\n      renderableComponentDefinition,\n      configPrefix,\n      editorContext,\n      compiledValues,\n      editableElement._component\n    );\n\n    /**\n     * Let's run custom editing function\n     */\n    if (renderableComponentDefinition.editing) {\n      const scalarizedValues = scalarizeConfig(\n        compiledValues,\n        editorContext.breakpointIndex,\n        editorContext.devices,\n        renderableComponentDefinition.schema\n      );\n\n      const identityEditingField = assertDefined(\n        editingInfo.fields.find((f) => f.prop === \"$myself\")\n      );\n\n      const editingInfoWithoutIdentityField: InternalEditingInfo = {\n        ...editingInfo,\n        // Filter out identity field, since it's not users responsibility to care of it.\n        fields: editingInfo.fields.filter((f) => f.prop !== \"$myself\"),\n      };\n\n      const editingInfoInput = convertInternalEditingInfoToEditingInfo(\n        editingInfoWithoutIdentityField,\n        configPrefix\n      );\n\n      const editingInfoResult = renderableComponentDefinition.editing({\n        values: scalarizedValues,\n        params: ownPropsAfterAuto!.params,\n        editingInfo: editingInfoInput,\n        device: editorContext.devices.find(\n          (device) => device.id === editorContext.breakpointIndex\n        )!,\n        ...(componentDefinition.id === \"@easyblocks/rich-text\" ||\n          componentDefinition.id === \"@easyblocks/rich-text-part\"\n          ? {\n            __SECRET_INTERNALS__: {\n              pathPrefix: configPrefix,\n              editorContext,\n            },\n          }\n          : {}),\n      });\n\n      if (editingInfoResult) {\n        const internalEditingInfo = convertEditingInfoToInternalEditingInfo(\n          editingInfoResult,\n          editingInfo,\n          componentDefinition,\n          editorContext,\n          configPrefix\n        );\n\n        internalEditingInfo.fields?.unshift(identityEditingField);\n        deepObjectMergeWithoutArrays(editingInfo, internalEditingInfo);\n      }\n    }\n\n    if (editingInfo)\n      // Save to __editing\n      applyEditingInfoToCompiledConfig(\n        compiled,\n        editingInfo,\n        parentComponentEditingInfo,\n        {\n          width: $width,\n          auto: $widthAuto,\n        }\n      );\n\n    editingContextProps = editingInfo.components;\n  }\n\n  compileSubcomponents(\n    editableElement,\n    contextProps,\n    subcomponentsContextProps,\n    compilationContext,\n    meta,\n    editingContextProps,\n    configPrefix,\n    compiled,\n    configAfterAuto,\n    cache\n  );\n\n  cache.set(ownProps.values._id, {\n    values: ownProps,\n    valuesAfterAuto: ownPropsAfterAuto!,\n    compiledValues,\n    compiledConfig: compiled,\n    contextProps: subcomponentsContextProps,\n    editingContextProps,\n  });\n\n  if (process.env.SHOPSTORY_INTERNAL_COMPILATION_DEBUG === \"true\") {\n    logCompilationDebugOutput({\n      cachedResult,\n      hasComponentConfigChanged,\n      configPrefix,\n      ownProps,\n      compiled,\n    });\n  }\n\n  return {\n    compiledComponentConfig: compiled,\n    configAfterAuto,\n  };\n}\n\nfunction validateStylesProps(\n  props: Record<string, unknown>,\n  componentDefinition: InternalComponentDefinition\n) {\n  for (const key of Object.keys(props)) {\n    const schemaProp = componentDefinition.schema.find((s) => s.prop === key);\n\n    if (!schemaProp || !(\"buildOnly\" in schemaProp)) {\n      continue;\n    }\n\n    if (!schemaProp.buildOnly) {\n      throw new Error(\n        `You've returned property \"${key}\" in \"props\" object that conflicts with the same prop in schema of component \"${componentDefinition.id}\". You can either change the property name or set the schema property as build-only (\\`buildOnly: true\\`).`\n      );\n    }\n  }\n}\n\nfunction logCompilationDebugOutput({\n  cachedResult,\n  hasComponentConfigChanged,\n  configPrefix,\n  ownProps,\n  compiled,\n}: {\n  cachedResult: CompilationCacheItemValue | undefined;\n  hasComponentConfigChanged: boolean;\n  configPrefix: string;\n  ownProps: Record<string, any>;\n  compiled: CompiledCustomComponentConfig | CompiledShopstoryComponentConfig;\n}) {\n  if (cachedResult && !hasComponentConfigChanged) {\n    console.groupCollapsed(\"[cache] \", configPrefix ? configPrefix : \"root\");\n  } else {\n    console.groupCollapsed(\"[compiled] \", configPrefix ? configPrefix : \"root\");\n  }\n\n  console.log(ownProps);\n  console.log(compiled);\n  console.groupEnd();\n}\n\nfunction createOwnComponentProps({\n  config,\n  contextProps,\n  componentDefinition,\n  compilationContext,\n}: {\n  config: NoCodeComponentEntry;\n  contextProps: ContextProps;\n  componentDefinition: InternalComponentDefinition;\n  compilationContext: CompilationContextType;\n}) {\n  // Copy all values and refs defined in schema, for component fields copy only _id, _component and its _itemProps but flattened\n  const values = Object.fromEntries(\n    componentDefinition.schema.map((schemaProp) => {\n      if (isSchemaPropComponentOrComponentCollection(schemaProp)) {\n        let configValue: Array<NoCodeComponentEntry> = config[schemaProp.prop];\n\n        if (configValue.length === 0) {\n          return [schemaProp.prop, []];\n        }\n\n        if (isSchemaPropComponent(schemaProp)) {\n          return [\n            schemaProp.prop,\n            [\n              {\n                _id: configValue[0]._id,\n                _component: configValue[0]._component,\n              },\n            ],\n          ];\n        }\n\n        if (isSchemaPropComponentCollectionLocalised(schemaProp)) {\n          configValue =\n            resolveLocalisedValue(\n              config[schemaProp.prop] as Record<\n                string,\n                Array<NoCodeComponentEntry>\n              >,\n              compilationContext\n            )?.value ?? [];\n        }\n\n        const configValuesWithFlattenedItemProps = configValue.map((config) => {\n          if (schemaProp.itemFields) {\n            const flattenedItemProps = flattenItemProps(\n              config,\n              componentDefinition,\n              schemaProp,\n              schemaProp.itemFields\n            );\n\n            return {\n              _id: config._id,\n              _component: config._component,\n              ...flattenedItemProps,\n            };\n          }\n\n          return {\n            _id: config._id,\n            _component: config._component,\n          };\n        });\n\n        return [schemaProp.prop, configValuesWithFlattenedItemProps];\n      }\n\n      return [schemaProp.prop, config[schemaProp.prop]];\n    })\n  );\n\n  const ownValues: { _id: string; _component: string;[key: string]: any } = {\n    // Copy id and component which uniquely identify component.\n    _id: config._id,\n    _component: config._component,\n    ...values,\n  };\n\n  return {\n    values: ownValues,\n    params: contextProps,\n  };\n}\n\nfunction flattenItemProps(\n  config: NoCodeComponentEntry,\n  componentDefinition: InternalComponentDefinition,\n  collectionSchemaProp:\n    | ComponentCollectionSchemaProp\n    | ComponentCollectionLocalisedSchemaProp,\n  itemsSchemas: Array<SchemaProp>\n) {\n  const itemProps = Object.fromEntries(\n    itemsSchemas.map((itemSchemaProp) => {\n      return [\n        itemSchemaProp.prop,\n        config._itemProps[componentDefinition.id][collectionSchemaProp.prop][\n        itemSchemaProp.prop\n        ],\n      ];\n    })\n  );\n\n  return itemProps;\n}\n\nfunction addComponentToSerializedComponentDefinitions(\n  component: NoCodeComponentEntry,\n  meta: CompilationMetadata,\n  componentType: keyof SerializedComponentDefinitions,\n  compilationContext: CompilationContextType\n) {\n  const definitions = meta.vars.definitions[componentType];\n\n  if (definitions.find((def: any) => def.id === component._component)) {\n    return;\n  }\n\n  const internalDefinition = findComponentDefinition(\n    component,\n    compilationContext\n  ) as InternalRenderableComponentDefinition;\n\n  const newDef: SerializedRenderableComponentDefinition = {\n    id: internalDefinition.id,\n    label: internalDefinition.label,\n    schema: internalDefinition.schema,\n    type: internalDefinition.type,\n  };\n\n  if (compilationContext.isEditing) {\n    newDef.pasteSlots = internalDefinition.pasteSlots ?? [];\n  }\n\n  definitions.push(newDef);\n}\n\nfunction compileSubcomponents(\n  editableElement: NoCodeComponentEntry,\n  contextProps: ContextProps,\n  subcomponentsContextProps: Record<string, Record<string, any>>,\n  compilationContext: CompilationContextType,\n  meta: any,\n  editingInfoComponents: InternalEditingInfo[\"components\"] | undefined,\n  configPrefix: string,\n  compiledComponentConfig: CompiledCustomComponentConfig,\n  configAfterAuto: NoCodeComponentEntry | null, // null means that we don't want auto\n  cache: CompilationCache\n) {\n  const componentDefinition = findComponentDefinition(\n    editableElement,\n    compilationContext\n  )!;\n\n  componentDefinition.schema.forEach((schemaProp: SchemaProp) => {\n    if (isSchemaPropComponentOrComponentCollection(schemaProp)) {\n      // Currently these are processed outside of compileSubcomponents\n      if (\n        isSchemaPropActionTextModifier(schemaProp) ||\n        isSchemaPropTextModifier(schemaProp)\n      ) {\n        return;\n      }\n\n      const childContextProps =\n        subcomponentsContextProps[schemaProp.prop] || {};\n\n      // Subcomponents must always have $width and $widthAuto defined. If wasn't set explicitly then parent's one is used.\n      childContextProps.$width =\n        childContextProps.$width ?? contextProps.$width;\n      childContextProps.$widthAuto =\n        childContextProps.$widthAuto ?? contextProps.$widthAuto;\n\n      if (\n        schemaProp.type === \"component-collection\" ||\n        schemaProp.type === \"component-collection-localised\"\n      ) {\n        childContextProps.itemProps = childContextProps.itemProps ?? [];\n\n        let value: any[];\n        if (schemaProp.type === \"component-collection\") {\n          value = editableElement[schemaProp.prop];\n        } else {\n          const resolvedValue = resolveLocalisedValue(\n            editableElement[schemaProp.prop],\n            compilationContext\n          );\n          if (!resolvedValue) {\n            throw new Error(\n              `Can't resolve localised value for prop \"${schemaProp.prop}\" of component ${editableElement._component}`\n            );\n          }\n          value = resolvedValue.value as any[];\n        }\n\n        value.forEach((_: any, index: number) => {\n          childContextProps.itemProps[index] =\n            childContextProps.itemProps[index] ?? {};\n          const itemPropContextProps = childContextProps.itemProps[index];\n\n          itemPropContextProps.$width =\n            itemPropContextProps.$width ?? contextProps.$width;\n          itemPropContextProps.$widthAuto =\n            itemPropContextProps.$widthAuto ?? contextProps.$widthAuto;\n        });\n      }\n\n      const compilationOutput = compileFromSchema(\n        editableElement[schemaProp.prop],\n        schemaProp,\n        compilationContext,\n        cache,\n        childContextProps,\n        meta,\n        editingInfoComponents?.[schemaProp.prop],\n        `${configPrefix}${configPrefix === \"\" ? \"\" : \".\"}${schemaProp.prop}`\n      ) as ConfigComponentCompilationOutput[];\n\n      compiledComponentConfig.components[schemaProp.prop] =\n        compilationOutput.map(\n          (compilationOutput) => compilationOutput.compiledComponentConfig\n        );\n\n      // Merge config after auto\n      if (compilationContext.isEditing && configAfterAuto !== null) {\n        if (schemaProp.type === \"component\") {\n          configAfterAuto[schemaProp.prop] = [\n            compilationOutput[0]?.configAfterAuto ?? [],\n          ];\n        } else if (\n          schemaProp.type === \"component-collection\" ||\n          schemaProp.type === \"component-collection-localised\"\n        ) {\n          const configsAfterAuto = compilationOutput.map(\n            (compilationOutput, index) => {\n              if (schemaProp.itemFields) {\n                const itemPropsCollectionPath = `_itemProps.${editableElement._component}.${schemaProp.prop}`;\n\n                const itemProps = Object.fromEntries(\n                  schemaProp.itemFields.map((itemSchemaProp) => {\n                    const itemPropValue =\n                      configAfterAuto[schemaProp.prop][index][\n                      itemSchemaProp.prop\n                      ];\n\n                    return [itemSchemaProp.prop, itemPropValue];\n                  })\n                );\n\n                dotNotationSet(\n                  compilationOutput.configAfterAuto,\n                  itemPropsCollectionPath,\n                  itemProps\n                );\n              }\n\n              return compilationOutput.configAfterAuto;\n            }\n          );\n\n          if (schemaProp.type === \"component-collection-localised\") {\n            // We store after auto config within context of current locale only\n            configAfterAuto[schemaProp.prop] = {\n              [compilationContext.contextParams.locale]: configsAfterAuto,\n            };\n          } else {\n            configAfterAuto[schemaProp.prop] = configsAfterAuto;\n          }\n        }\n      }\n    }\n  });\n}\n\nfunction calculateWidths(\n  compilationContext: CompilationContextType,\n  contextProps: ContextProps\n) {\n  const $width: TrulyResponsiveValue<number> = { $res: true };\n  const $widthAuto: TrulyResponsiveValue<boolean> = { $res: true };\n\n  compilationContext.devices.forEach((device) => {\n    $width[device.id] = contextProps.$width?.[device.id] ?? -1;\n    $widthAuto[device.id] =\n      contextProps.$widthAuto?.[device.id] ??\n      ($width[device.id] === -1 ? true : false);\n  });\n  return { $width, $widthAuto };\n}\n\nfunction itemFieldsForEach(\n  config: NoCodeComponentEntry,\n  compilationContext: CompilationContextType,\n  callback: (arg: {\n    collectionSchemaProp:\n    | ComponentCollectionLocalisedSchemaProp\n    | ComponentCollectionSchemaProp;\n    itemIndex: number;\n    itemSchemaProp: SchemaProp;\n    itemPropPath: string;\n    itemPropValue: any;\n  }) => void\n) {\n  const componentDefinition = findComponentDefinition(\n    config,\n    compilationContext\n  )!;\n\n  componentDefinition.schema.forEach((schemaProp) => {\n    if (isSchemaPropCollection(schemaProp)) {\n      const itemFields = (schemaProp as ComponentCollectionSchemaProp)\n        .itemFields;\n\n      let path = schemaProp.prop;\n\n      if (schemaProp.type === \"component-collection-localised\") {\n        const localizedValue = resolveLocalisedValue(\n          config[schemaProp.prop],\n          compilationContext\n        );\n\n        if (localizedValue) {\n          path = `${path}.${localizedValue.locale}`;\n        } else {\n          path = `${path}.${compilationContext.contextParams.locale}`;\n        }\n      }\n\n      const value: Array<NoCodeComponentEntry> =\n        dotNotationGet(config, path) ?? [];\n\n      value.forEach((_, index) => {\n        if (itemFields) {\n          itemFields.forEach((itemSchemaProp) => {\n            const itemPath = `${path}.${index}.${itemSchemaProp.prop}`;\n            const itemValue = dotNotationGet(config, itemPath);\n\n            callback({\n              collectionSchemaProp: schemaProp,\n              itemIndex: index,\n              itemSchemaProp,\n              itemPropPath: itemPath,\n              itemPropValue: itemValue,\n            });\n          });\n        }\n      });\n    }\n  });\n}\n\nfunction resolveLocalisedValue<T>(\n  localisedValue: Record<string, T>,\n  compilationContext: CompilationContextType\n): { value: T; locale: string } | undefined {\n  const locale = compilationContext.contextParams.locale;\n\n  if (localisedValue[locale] !== undefined) {\n    return {\n      value: localisedValue[locale],\n      locale,\n    };\n  }\n\n  const fallbackLocale = getFallbackLocaleForLocale(\n    locale,\n    compilationContext.locales\n  );\n\n  if (!fallbackLocale) {\n    return;\n  }\n\n  return {\n    value: localisedValue[fallbackLocale],\n    locale: fallbackLocale,\n  };\n}\n\nfunction buildDefaultEditingInfo(\n  definition: InternalComponentDefinition,\n  configPrefix: string,\n  editorContext: EditorContextType,\n  compiledValues: Record<string, any>,\n  templateId: string\n) {\n  const scalarizedConfig = scalarizeConfig(\n    compiledValues,\n    editorContext.breakpointIndex,\n    editorContext.devices,\n    definition.schema\n  );\n\n  const schema = [...definition.schema];\n\n  let defaultFields: Array<InternalEditingField> = schema\n    // Right now, component-collection schema prop isn't shown in the sidebar\n    .filter((schemaProp) => !isSchemaPropCollection(schemaProp))\n    .filter((schemaProp) => {\n      if (compiledValues.noTrace && schemaProp.prop.startsWith(\"trace\")) {\n        return false;\n      }\n      return true;\n    })\n    .map((schemaProp) =>\n      getDefaultFieldDefinition(\n        schemaProp,\n        configPrefix,\n        definition,\n        editorContext,\n        scalarizedConfig,\n        templateId\n      )\n    );\n\n  // noAction is a special property\n  if (compiledValues.noAction) {\n    defaultFields = defaultFields.filter((field) => field.path !== \"action\");\n  }\n\n  const pathInfo = parsePath(configPrefix, editorContext.form);\n  const parentInfo = pathInfo.parent;\n\n  if (parentInfo) {\n    const parentDefinition = findComponentDefinitionById(\n      parentInfo.templateId,\n      editorContext\n    );\n\n    if (!parentDefinition) {\n      throw new Error(`Can't find parent definition: ${parentInfo.templateId}`);\n    }\n    const parentSchemaProp = parentDefinition.schema.find(\n      (schemaProp) => schemaProp.prop === parentInfo.fieldName\n    ) as\n      | ComponentSchemaProp\n      | ComponentCollectionSchemaProp\n      | ComponentCollectionLocalisedSchemaProp;\n\n    if (!parentSchemaProp) {\n      throw new Error(\n        `Can't find parent schemaProp: ${parentInfo.templateId} > ${parentInfo.fieldName}`\n      );\n    }\n\n    let required: boolean;\n\n    if (parentSchemaProp.type === \"component\") {\n      required = !!parentSchemaProp.required;\n    } else {\n      required = false;\n    }\n\n    const headerSchemaProp: Component$$$SchemaProp = {\n      prop: \"$myself\",\n      label: \"Component type\",\n      type: \"component$$$\",\n      picker: parentSchemaProp.picker,\n      definition: parentDefinition,\n      required,\n      group: \"Component\",\n    };\n\n    const headerField: InternalEditingField = {\n      component: \"identity\",\n      hidden: false,\n      label: \"Component type\",\n      name: configPrefix,\n      prop: \"$myself\",\n      schemaProp: headerSchemaProp,\n    };\n\n    defaultFields.unshift(headerField);\n  } else {\n    const rootComponentDefinition = assertDefined(\n      findComponentDefinitionById(\n        dotNotationGet(editorContext.form.values, \"\")._component,\n        editorContext\n      )\n    );\n\n    const headerSchemaProp: Component$$$SchemaProp = {\n      prop: \"$myself\",\n      label: \"Component type\",\n      type: \"component$$$\",\n      definition: rootComponentDefinition,\n      required: true,\n      group: \"Component\",\n    };\n\n    const headerField: InternalEditingField = {\n      component: \"identity\",\n      hidden: false,\n      label: \"Component type\",\n      name: \"\",\n      prop: \"$myself\",\n      schemaProp: headerSchemaProp,\n    };\n\n    defaultFields.unshift(headerField);\n  }\n\n  const fields = bubbleDown((x) => x.prop === \"Analytics\", defaultFields);\n\n  const editingInfo: InternalEditingInfo = {\n    fields,\n    components: {},\n  };\n\n  definition.schema.forEach((schemaProp) => {\n    if (isSchemaPropCollection(schemaProp)) {\n      editingInfo.components[schemaProp.prop] = {\n        items: scalarizedConfig[schemaProp.prop].map(\n          (x: any, index: number) => ({\n            fields: (schemaProp.itemFields ?? []).map((itemSchemaProp) =>\n              getDefaultFieldDefinition(\n                itemSchemaProp,\n                `${configPrefix}${configPrefix === \"\" ? \"\" : \".\"}${schemaProp.prop\n                }.${index}._itemProps.${definition.id}.${schemaProp.prop}`,\n                definition,\n                editorContext,\n                scalarizedConfig,\n                templateId\n              )\n            ),\n          })\n        ),\n      };\n    } else if (isSchemaPropComponent(schemaProp)) {\n      editingInfo.components[schemaProp.prop] = {\n        fields: [],\n      };\n    }\n  });\n\n  return editingInfo;\n}\n\nfunction applyEditingInfoToCompiledConfig(\n  compiledComponentConfig: CompiledCustomComponentConfig,\n  editingInfo: InternalEditingInfo,\n  parentEditingInfo:\n    | EditingInfoComponent\n    | EditingInfoComponentCollection\n    | undefined,\n  widthInfo: {\n    width: TrulyResponsiveValue<number>;\n    auto: TrulyResponsiveValue<boolean>;\n  }\n) {\n  const headerFields = editingInfo.fields.filter(\n    (field) => field.prop === \"$myself\"\n  );\n\n  const nonHeaderFields = editingInfo.fields.filter(\n    (field) => field.prop !== \"$myself\"\n  );\n\n  const fields = [\n    ...headerFields,\n    ...(parentEditingInfo && \"fields\" in parentEditingInfo\n      ? parentEditingInfo.fields\n      : []),\n    ...nonHeaderFields,\n  ];\n\n  compiledComponentConfig.__editing = {\n    ...parentEditingInfo,\n    fields,\n    components: {},\n    widthInfo,\n  };\n\n  for (const fieldName in editingInfo.components) {\n    compiledComponentConfig.__editing.components[fieldName] = {};\n    const childComponentEditingInfo = editingInfo.components[fieldName];\n\n    // Here we copy only noInline. It's the only flag we need in parent component. It's only because we need noInline info even if there is no component in array (to know that we shouldn't render placeholder)\n    if (\n      \"noInline\" in childComponentEditingInfo &&\n      childComponentEditingInfo.noInline !== undefined\n    ) {\n      compiledComponentConfig.__editing.components[fieldName].noInline =\n        childComponentEditingInfo.noInline;\n    }\n  }\n}\n\nconst deepObjectMergeWithoutArrays = (target: any, source: any) => {\n  // Iterate through `source` properties and if an `Object` set property to merge of `target` and `source` properties\n  for (const key of Object.keys(source)) {\n    if (source[key] instanceof Object && !Array.isArray(source[key]))\n      Object.assign(\n        source[key],\n        deepObjectMergeWithoutArrays(target[key], source[key])\n      );\n  }\n\n  // Join `target` and modified `source`\n  Object.assign(target || {}, source);\n  return target;\n};\n\nfunction compileRichTextValuesFromRichTextParts(\n  richTextConfig: RichTextComponentConfig,\n  compilationContext: CompilationContextType,\n  cache: CompilationCache\n): { mainColor: any; mainFont: any } {\n  const mainColor = getMostCommonValueFromRichTextParts(\n    richTextConfig,\n    \"color\",\n    compilationContext,\n    cache\n  );\n\n  const mainFont = getMostCommonValueFromRichTextParts(\n    richTextConfig,\n    \"font\",\n    compilationContext,\n    cache\n  );\n\n  return { mainColor, mainFont };\n}\n\nfunction mapResponsiveFontToResponsiveFontSize(\n  responsiveFontValue: Record<string, any>\n) {\n  return Object.fromEntries(\n    entries(responsiveFontValue).map(([breakpoint, fontValue]) => {\n      if (breakpoint === \"$res\") {\n        return [breakpoint, fontValue];\n      }\n\n      return [breakpoint, fontValue.fontSize];\n    })\n  );\n}\n\nfunction addStylesHash(styles: Record<PropertyKey, any>) {\n  if (\"__hash\" in styles) {\n    delete styles[\"__hash\"];\n  }\n\n  const hash = xxHash32(JSON.stringify(styles));\n  styles.__hash = hash.toString();\n  return styles;\n}\n\nfunction compileBoxes(\n  value: any,\n  compilationContext: CompilationContextType\n): any {\n  if (Array.isArray(value)) {\n    return value.map((x: any) => compileBoxes(x, compilationContext));\n  } else if (typeof value === \"object\" && value !== null) {\n    if (value.__isBox) {\n      return addStylesHash(compileBox(value, compilationContext.devices));\n    }\n\n    const ret: Record<string, any> = {};\n    for (const key in value) {\n      ret[key] = compileBoxes(value[key], compilationContext);\n    }\n    return ret;\n  }\n  return value;\n}\n\nfunction getDefaultFieldDefinition(\n  schemaProp: SchemaProp,\n  configPrefix: string,\n  definition: InternalComponentDefinition,\n  editorContext: EditorContextType,\n  compiledValues: Record<string, any>,\n  templateId: string\n): InternalEditingField {\n  const tinaField = getTinaField(\n    {\n      ...schemaProp,\n      definition,\n    },\n    editorContext,\n    compiledValues[schemaProp.prop]\n  );\n\n  let visible = !isSchemaPropComponentOrComponentCollection(schemaProp);\n\n  if (typeof schemaProp.visible === \"boolean\") {\n    visible = schemaProp.visible;\n  } else if (typeof schemaProp.visible === \"function\") {\n    visible = schemaProp.visible(compiledValues, { editorContext });\n  }\n\n  return {\n    ...tinaField,\n    prop: schemaProp.prop,\n    name: createFieldName(schemaProp, configPrefix),\n    hidden: !visible,\n  };\n}\n\nfunction createFieldName(schemaProp: SchemaProp, configPrefix: string): string {\n  return schemaProp.prop === \"$myself\"\n    ? configPrefix\n    : `${configPrefix}${configPrefix === \"\" ? \"\" : \".\"}${schemaProp.prop}`;\n}\n\nfunction convertInternalEditingInfoToEditingInfo(\n  editingInfo: InternalEditingInfo,\n  configPrefix: string | undefined\n): EditingInfo {\n  const fields = editingInfo.fields.map((f) => {\n    return convertInternalEditingFieldToEditingInfoField(f, configPrefix);\n  });\n\n  const components: EditingInfo[\"components\"] = Object.fromEntries(\n    Object.entries(editingInfo.components).map(([name, childEditingInfo]) => {\n      if (\"items\" in childEditingInfo) {\n        const adaptedChildEditingInfo =\n          childEditingInfo.items.map<ChildComponentEditingInfo>((item) => {\n            return {\n              fields: item.fields.map((f) =>\n                convertInternalEditingFieldToEditingInfoField(f, configPrefix)\n              ),\n              direction: item.direction,\n              selectable: item.noInline,\n            };\n          });\n\n        return [name, adaptedChildEditingInfo];\n      }\n\n      return [\n        name,\n        {\n          fields: childEditingInfo.fields.map((f) =>\n            convertInternalEditingFieldToEditingInfoField(f, configPrefix)\n          ),\n          direction: childEditingInfo.direction,\n          selectable: childEditingInfo.noInline,\n        },\n      ];\n    })\n  );\n\n  return {\n    fields,\n    components,\n  };\n}\n\nfunction convertInternalEditingFieldToEditingInfoField(\n  field: InternalEditingField,\n  configPrefix: string | undefined\n): EditingField {\n  const path =\n    field.schemaProp.prop === \"$myself\"\n      ? field.schemaProp.prop\n      : toRelativeFieldPath(field.name, configPrefix);\n\n  return {\n    path,\n    type: \"field\",\n    visible: typeof field.hidden === \"boolean\" ? !field.hidden : true,\n    group: field.group,\n    label: field.label,\n  };\n}\n\nfunction toRelativeFieldPath(path: string, configPrefix: string | undefined) {\n  let adjustedPath = path;\n\n  if (path.includes(\"_itemProps\")) {\n    const pathFragments = path.split(\".\");\n    const itemPropsFragmentIndex = pathFragments.indexOf(\"_itemProps\");\n    const adjustedPathFragments = [\n      ...pathFragments.slice(0, itemPropsFragmentIndex),\n      pathFragments.at(-1),\n    ];\n    adjustedPath = adjustedPathFragments.join(\".\");\n  }\n\n  return configPrefix\n    ? adjustedPath.replace(`${configPrefix}.`, \"\")\n    : adjustedPath;\n}\n\nfunction convertEditingInfoToInternalEditingInfo(\n  editingInfo: NoCodeComponentEditingFunctionResult,\n  internalEditingInfo: InternalEditingInfo,\n  componentDefinition: InternalRenderableComponentDefinition,\n  editorContext: EditorContextType,\n  configPrefix: string | undefined\n): InternalEditingFunctionResult {\n  let internalEditingInfoFields:\n    | InternalEditingFunctionResult[\"fields\"]\n    | undefined;\n\n  if (editingInfo.fields) {\n    if (!internalEditingInfoFields) {\n      internalEditingInfoFields = [];\n    }\n\n    for (const field of editingInfo.fields) {\n      const internalEditingInfoField =\n        convertEditingFieldToInternalEditingField(\n          field,\n          internalEditingInfo,\n          componentDefinition,\n          editorContext,\n          configPrefix\n        );\n\n      internalEditingInfoFields.push(internalEditingInfoField);\n    }\n  }\n\n  let internalEditingInfoComponents:\n    | InternalEditingFunctionResult[\"components\"]\n    | undefined;\n\n  if (editingInfo.components) {\n    internalEditingInfoComponents = {};\n\n    for (const [name, childEditingInfo] of Object.entries(\n      editingInfo.components\n    )) {\n      const sourceInternalEditingInfoComponent =\n        internalEditingInfo.components[name];\n\n      if (!sourceInternalEditingInfoComponent) {\n        throw new Error(\n          `Found component at path ${configPrefix} but it's not defined in the schema`\n        );\n      }\n\n      if (Array.isArray(childEditingInfo)) {\n        internalEditingInfoComponents[name] = {\n          items: childEditingInfo.map((editingInfoItem, index) => {\n            const sourceInternalFields = (\n              sourceInternalEditingInfoComponent as EditingInfoComponentCollection\n            ).items[index].fields;\n\n            const internalFields = editingInfoItem.fields?.map((field) => {\n              const internalEditingInfoField =\n                convertEditingFieldToInternalEditingField(\n                  field,\n                  internalEditingInfo,\n                  componentDefinition,\n                  editorContext,\n                  configPrefix\n                );\n\n              return internalEditingInfoField;\n            });\n\n            const result: EditingInfoComponent = {\n              fields: internalFields ?? sourceInternalFields,\n            };\n\n            if (editingInfoItem.direction) {\n              result.direction = editingInfoItem.direction;\n            }\n\n            if (editingInfoItem.selectable !== undefined) {\n              result.noInline = !editingInfoItem.selectable;\n            }\n\n            return result;\n          }),\n        };\n      } else {\n        const result: Partial<EditingInfoComponent> = {};\n\n        if (childEditingInfo.fields) {\n          result.fields = childEditingInfo.fields.map((field) => {\n            const internalEditingInfoField =\n              convertEditingFieldToInternalEditingField(\n                field,\n                internalEditingInfo,\n                componentDefinition,\n                editorContext,\n                configPrefix\n              );\n\n            return internalEditingInfoField;\n          });\n        }\n\n        if (childEditingInfo.direction) {\n          result.direction = childEditingInfo.direction;\n        }\n\n        if (childEditingInfo.selectable !== undefined) {\n          result.noInline = !childEditingInfo.selectable;\n        }\n\n        internalEditingInfoComponents[name] = result;\n      }\n    }\n  }\n\n  const result: InternalEditingFunctionResult = {};\n\n  if (internalEditingInfoFields) {\n    result.fields = internalEditingInfoFields;\n  }\n\n  if (internalEditingInfoComponents) {\n    result.components = internalEditingInfoComponents;\n  }\n\n  return result;\n}\n\nfunction convertEditingFieldToInternalEditingField(\n  field: AnyEditingField,\n  internalEditingInfo: InternalEditingInfo,\n  componentDefinition: InternalRenderableComponentDefinition,\n  editorContext: EditorContextType,\n  configPrefix: string | undefined\n): NonNullable<InternalEditingFunctionResult[\"fields\"]>[number] {\n  if (\n    componentDefinition.id === \"@easyblocks/rich-text\" ||\n    componentDefinition.id === \"@easyblocks/rich-text-part\"\n  ) {\n    // This is a special case. Rich text components have a really nasty `editing` function implementation\n    // relying on `editorContext`, absolute paths and multi field portals. Ideally it would best to address this,\n    // but right now let's keep it as it is and treat it like an exception\n\n    // Even though the type definition for field doesn't allow `path` to be an array, $richText component\n    // returns an array of paths.\n    if (Array.isArray(field.path)) {\n      const fieldName =\n        field.path[0]?.split(\".\").at(-1) ??\n        raiseError(\"Expected field name to be present\");\n      const sources = field.path.map((p) =>\n        p.split(\".\").slice(0, -1).join(\".\")\n      );\n\n      return {\n        portal: \"multi-field\",\n        fieldName,\n        sources,\n      };\n    }\n\n    const isAbsolutePath = isFieldPathAbsolutePath(field, editorContext);\n\n    if (isAbsolutePath) {\n      if (field.type === \"fields\") {\n        const groups = field.filters?.group\n          ? toArray(field.filters.group)\n          : undefined;\n\n        return {\n          portal: \"component\",\n          source: field.path,\n          groups,\n        };\n      }\n\n      const pathFragments = field.path.split(\".\");\n      const fieldName =\n        pathFragments.at(-1) ?? raiseError(\"Expected field name to be present\");\n      const source = pathFragments.slice(0, -1).join(\".\");\n\n      return {\n        portal: \"field\",\n        source,\n        fieldName,\n      };\n    }\n  }\n\n  if (field.type === \"field\") {\n    let sourceInternalEditingInfoField = internalEditingInfo.fields.find(\n      (f) => {\n        return (\n          f.name === toAbsolutePath(field.path, configPrefix) ||\n          field.path === \"$myself\"\n        );\n      }\n    );\n\n    if (!sourceInternalEditingInfoField) {\n      const pathFragments = field.path.split(\".\");\n      const isPathToComponentField = pathFragments.length > 1;\n\n      if (isPathToComponentField) {\n        const componentSchemaProp = componentDefinition.schema.find(\n          isSchemaPropComponentOrComponentCollection\n        );\n\n        if (componentSchemaProp) {\n          if (isSchemaPropCollection(componentSchemaProp)) {\n            const itemField = componentSchemaProp.itemFields?.find(\n              (f) => f.prop === pathFragments.at(-1)\n            );\n\n            if (itemField) {\n              const componentItemIndex = +pathFragments[1];\n              sourceInternalEditingInfoField = (\n                internalEditingInfo.components[\n                componentSchemaProp.prop\n                ] as EditingInfoComponentCollection\n              ).items[componentItemIndex].fields.find(\n                (f) => f.prop === itemField.prop\n              );\n            }\n          }\n\n          if (\n            componentSchemaProp.type === \"component\" &&\n            componentSchemaProp.required\n          ) {\n            const absoluteFieldPath = toAbsolutePath(\n              pathFragments.slice(0, -1).join(\".\"),\n              configPrefix\n            );\n\n            const overrides: Extract<\n              FieldPortal,\n              { portal: \"field\" }\n            >[\"overrides\"] = {};\n\n            if (field.label !== undefined) {\n              overrides.label = field.label;\n            }\n\n            if (field.group !== undefined) {\n              overrides.group = field.group;\n            }\n\n            return {\n              portal: \"field\",\n              fieldName: pathFragments.at(-1)!,\n              source: absoluteFieldPath,\n              overrides,\n            };\n          }\n        }\n      }\n\n      if (!sourceInternalEditingInfoField) {\n        throw new Error(\n          `Field \"${field.path}\" for component \"${componentDefinition.id}\" not found.`\n        );\n      }\n    }\n\n    return {\n      ...sourceInternalEditingInfoField,\n      label: field.label,\n      group: field.group,\n      hidden: !field.visible,\n    };\n  }\n\n  if (field.type === \"fields\") {\n    const absoluteFieldPath = toAbsolutePath(field.path, configPrefix);\n\n    return {\n      portal: \"component\",\n      source: absoluteFieldPath,\n      ...(field.filters?.group !== undefined && {\n        groups: toArray(field.filters.group),\n      }),\n    };\n  }\n\n  throw new Error(`Unknown field type`);\n}\n\nfunction isFieldPathAbsolutePath(\n  field: AnyEditingField,\n  editorContext: EditorContextType\n) {\n  const pathFragments = field.path.split(\".\");\n  const rootValue = dotNotationGet(editorContext.form.values, \"\");\n  let currentPathFragmentIndex = 0;\n\n  let currentValue = dotNotationGet(\n    rootValue,\n    pathFragments[currentPathFragmentIndex]\n  );\n\n  while (currentValue !== undefined) {\n    if (pathFragments.length - 1 === currentPathFragmentIndex) {\n      return true;\n    }\n\n    currentValue = dotNotationGet(\n      currentValue,\n      pathFragments[++currentPathFragmentIndex]\n    );\n  }\n\n  return false;\n}\n\nfunction toAbsolutePath(path: string, configPrefix: string | undefined) {\n  if (configPrefix) {\n    return `${configPrefix}.${path}`;\n  }\n\n  return path;\n}\n\nfunction isSchemaPropTokenized(schemaProp: SchemaProp) {\n  return (\n    schemaProp.type === \"color\" ||\n    schemaProp.type === \"space\" ||\n    schemaProp.type === \"font\" ||\n    schemaProp.type === \"aspectRatio\" ||\n    schemaProp.type === \"boxShadow\" ||\n    schemaProp.type === \"containerWidth\"\n  );\n}\n"],"names":["compileComponent","editableElement","compilationContext","contextProps","meta","cache","parentComponentEditingInfo","configPrefix","arguments","length","undefined","isComponentConfig","console","error","Error","$width","_id","_component","cachedResult","get","componentDefinition","findComponentDefinitionById","assertDefined","id","uniqueId","warn","ownProps","createOwnComponentProps","config","hasComponentConfigChanged","ownPropsAfterAuto","compiled","props","components","styled","configAfterAuto","editingInfo","compiledValues","subcomponentsContextProps","editingContextProps","deepCompare","values","valuesAfterAuto","compiledConfig","deepClone","params","addComponentToSerializedComponentDefinitions","$widthAuto","calculateWidths","DEFAULT_SPACE_AUTO_CONSTANT","schema","forEach","schemaProp","isSchemaPropTokenized","prop","applyAutoUsingResponsiveTokens","type","linearizeSpace","autoConstant","itemFieldsForEach","arg","value","itemPropValue","itemSchemaProp","dotNotationSet","itemPropPath","autoFunction","auto","ownValuesAfterAuto","devices","responsiveValueFill","getDevicesWidths","_compiledValues","compileComponentValues","_ref","itemIndex","collectionSchemaProp","compiledValue","compileFromSchema","isListStyleAuto","mainColor","mainFont","compileRichTextValuesFromRichTextParts","mainFontSize","mapResponsiveFontToResponsiveFontSize","renderableComponentDefinition","isEditing","editorContext","buildDefaultEditingInfo","editing","scalarizedConfig","scalarizeConfig","breakpointIndex","identityEditingField","fields","find","f","editingInfoWithoutIdentityField","filter","editingInfoInput","convertInternalEditingInfoToEditingInfo","editingInfoResult","device","__SECRET_INTERNALS__","pathPrefix","internalEditingInfo","convertEditingInfoToInternalEditingInfo","unshift","deepObjectMergeWithoutArrays","applyEditingInfoToCompiledConfig","width","resop2","_ref2","styles","stylesInput","responsiveValueAt","__COMPILATION_CONTEXT__","validateStylesProps","key","Array","isArray","map","v","__isBox","x","compileBoxes","buildOnly","isExternalSchemaProp","types","Object","fromEntries","keys","deviceId","responsiveValueNormalize","scalarizedValues","compileSubcomponents","set","process","env","SHOPSTORY_INTERNAL_COMPILATION_DEBUG","logCompilationDebugOutput","compiledComponentConfig","s","_ref3","groupCollapsed","log","groupEnd","_ref4","isSchemaPropComponentOrComponentCollection","configValue","isSchemaPropComponent","isSchemaPropComponentCollectionLocalised","resolveLocalisedValue","configValuesWithFlattenedItemProps","itemFields","flattenedItemProps","flattenItemProps","ownValues","itemsSchemas","itemProps","_itemProps","component","componentType","definitions","vars","def","internalDefinition","findComponentDefinition","newDef","label","pasteSlots","push","editingInfoComponents","isSchemaPropActionTextModifier","isSchemaPropTextModifier","childContextProps","resolvedValue","_","index","itemPropContextProps","compilationOutput","configsAfterAuto","itemPropsCollectionPath","contextParams","locale","$res","callback","isSchemaPropCollection","path","localizedValue","dotNotationGet","itemPath","itemValue","localisedValue","fallbackLocale","getFallbackLocaleForLocale","locales","definition","templateId","defaultFields","noTrace","startsWith","getDefaultFieldDefinition","noAction","field","pathInfo","parsePath","form","parentInfo","parent","parentDefinition","parentSchemaProp","fieldName","required","headerSchemaProp","picker","group","headerField","hidden","name","rootComponentDefinition","bubbleDown","items","parentEditingInfo","widthInfo","headerFields","nonHeaderFields","__editing","childComponentEditingInfo","noInline","target","source","assign","richTextConfig","getMostCommonValueFromRichTextParts","responsiveFontValue","entries","_ref5","breakpoint","fontValue","fontSize","addStylesHash","hash","xxHash32","JSON","stringify","__hash","toString","compileBox","ret","tinaField","getTinaField","visible","createFieldName","convertInternalEditingFieldToEditingInfoField","_ref6","childEditingInfo","adaptedChildEditingInfo","item","direction","selectable","toRelativeFieldPath","adjustedPath","includes","pathFragments","split","itemPropsFragmentIndex","indexOf","adjustedPathFragments","slice","at","join","replace","internalEditingInfoFields","internalEditingInfoField","convertEditingFieldToInternalEditingField","internalEditingInfoComponents","sourceInternalEditingInfoComponent","editingInfoItem","sourceInternalFields","internalFields","result","raiseError","sources","p","portal","isAbsolutePath","isFieldPathAbsolutePath","groups","filters","toArray","sourceInternalEditingInfoField","toAbsolutePath","isPathToComponentField","componentSchemaProp","itemField","componentItemIndex","absoluteFieldPath","overrides","rootValue","currentPathFragmentIndex","currentValue"],"mappings":"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"}