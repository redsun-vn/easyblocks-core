{"version":3,"file":"getRichTextComponentConfigFragment.js","sources":["../../../../../../src/compiler/builtins/$richText/utils/getRichTextComponentConfigFragment.ts"],"sourcesContent":["import {\n  dotNotationGet as get,\n  dotNotationSet as set,\n} from \"@/utils\";\nimport { RichTextComponentConfig } from \"../$richText\";\nimport { RichTextPartComponentConfig } from \"../$richTextPart/$richTextPart\";\nimport { duplicateConfig } from \"../../../duplicateConfig\";\nimport { EditorContextType } from \"../../../types\";\nimport { parseFocusedRichTextPartConfigPath } from \"./parseRichTextPartConfigPath\";\nimport { stripRichTextPartSelection } from \"./stripRichTextTextPartSelection\";\n\nfunction getRichTextComponentConfigFragment(\n  sourceRichTextComponentConfig: RichTextComponentConfig,\n  editorContext: EditorContextType\n): RichTextComponentConfig & {\n  _itemProps?: Record<string, unknown>;\n} {\n  const { focussedField, form, contextParams } = editorContext;\n\n  const newRichTextComponentConfig: RichTextComponentConfig = {\n    ...sourceRichTextComponentConfig,\n    elements: {\n      [contextParams.locale]: [],\n    },\n  };\n\n  focussedField.forEach((focusedField) => {\n    const textPartConfig: RichTextPartComponentConfig = get(\n      form.values,\n      stripRichTextPartSelection(focusedField)\n    );\n\n    const { path, range } = parseFocusedRichTextPartConfigPath(focusedField);\n\n    const newTextPartConfig = duplicateConfig(textPartConfig, editorContext);\n\n    if (range) {\n      newTextPartConfig.value = textPartConfig.value.slice(...range);\n    }\n\n    let lastParentConfigPath = `elements.${contextParams.locale}`;\n\n    path.slice(0, -1).forEach((pathIndex, index) => {\n      let currentConfigPath = lastParentConfigPath;\n\n      if (index === 0) {\n        currentConfigPath += `.${pathIndex}`;\n      } else {\n        const parentConfig = get(\n          newRichTextComponentConfig,\n          lastParentConfigPath\n        );\n\n        currentConfigPath += `.elements.${Math.min(\n          parentConfig.elements.length,\n          pathIndex\n        )}`;\n      }\n\n      const currentConfig = get(newRichTextComponentConfig, currentConfigPath);\n\n      if (!currentConfig) {\n        const sourceConfigPath =\n          lastParentConfigPath +\n          (index === 0 ? `.${pathIndex}` : `.elements.${pathIndex}`);\n\n        const sourceConfig = get(\n          sourceRichTextComponentConfig,\n          sourceConfigPath\n        );\n\n        const configCopy = {\n          ...sourceConfig,\n          elements: [],\n        };\n\n        set(newRichTextComponentConfig, currentConfigPath, configCopy);\n      }\n\n      lastParentConfigPath = currentConfigPath;\n    });\n\n    const textPartParentConfig = get(\n      newRichTextComponentConfig,\n      lastParentConfigPath\n    );\n\n    set(newRichTextComponentConfig, lastParentConfigPath, {\n      ...textPartParentConfig,\n      elements: [...textPartParentConfig.elements, newTextPartConfig],\n    });\n  });\n\n  return newRichTextComponentConfig;\n}\n\nexport { getRichTextComponentConfigFragment };\n"],"names":["getRichTextComponentConfigFragment","sourceRichTextComponentConfig","editorContext","focussedField","form","contextParams","newRichTextComponentConfig","elements","locale","forEach","focusedField","textPartConfig","get","values","stripRichTextPartSelection","path","range","parseFocusedRichTextPartConfigPath","newTextPartConfig","duplicateConfig","value","slice","lastParentConfigPath","pathIndex","index","currentConfigPath","parentConfig","Math","min","length","currentConfig","sourceConfigPath","sourceConfig","configCopy","set","textPartParentConfig"],"mappings":"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"}